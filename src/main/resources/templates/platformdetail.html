<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout::common_head(~{::title}, ~{::supplement})">
	<meta charset="UTF-8">
	<title>业务详情</title>
	<script src="../static/js/jquery-3.2.1.min.js" th:src="@{js/jquery-3.2.1.min.js}"></script>
	<script src="../static/js/semantic.js" th:src="@{js/semantic.js}"></script>
	<link rel="stylesheet" href="../static/css/semantic.css" th:href="@{/css/semantic.css}"/>
	<link rel="stylesheet" href="../static/css/icon.css" th:href="@{css/icon.css}"/>
	<link href="../static/css/ionicons.min.css" rel="stylesheet" th:href="@{css/ionicons.min.css}"/>
	<link href="../static/css/main.css" rel="stylesheet" th:href="@{css/main.css}"/>
	<link href="../static/css/pace.css" rel="stylesheet" th:href="@{css/pace.css}"/>
	<link href="../static/css/lobibox.css" rel="stylesheet" th:href="@{css/lobibox.css}"/>

	<th:block th:fragment="supplement">
		<script src="https://gw.alipayobjects.com/as/g/datavis/g6/1.1.3/index.js"></script>
		<script src="../static/js/echarts.min.js" th:src="@{js/echarts.min.js}"></script>
		<script src="../static/js/notifications.js" th:src="@{js/notifications.js}"></script>
		<script src="http://rapapi.org/rap.plugin.js?projectId=19544&mode=0"></script>
		<style type="text/css">
		.textOverflow{
		overflow: hidden; /*自动隐藏文字*/
		text-overflow: ellipsis;/*文字隐藏后添加省略号*/
		white-space: nowrap;/*强制不换行*/
		}
		.ui.segment.noBorder{ border:0; }
		.ui.tab.segment.fixedHeight{ height: 500px; }
		.ui.segment.row1Height{ height: 160px; }
		.chartBar{ height: 140px; }
		.ui.menu.row2Height{
			height: 265px;
			width: 100%;
			overflow:auto;
			overflow-x:hidden
		}
		.ui.segment.row2_3Height{
			height: 253px;
			width: 100%;
			overflow:auto;
			overflow-x:hidden
		}
		</style>
	</th:block>
</head>
<body>
<!--header start-->
<div id="contextWrap">
	<!--sidebar-->
	<div class="ui sidebar vertical left menu overlay  borderless visible sidemenu inverted  grey" data-color="grey"
		 th:replace="layout::left_menu">
		<a class="item logo" href="index.html">
			<img src="../static/images/logo.png" alt="stagblogo"/><img src="../static/images/thumblogo.png"
																	   alt="stagblogo" class="displaynone"/>
		</a>
		<div class="ui accordion inverted">
			<div class="title item">
                <i class="ion-speedometer titleIcon icon"></i>仪表盘
			</div>
			<div class="content">
				<a class="item" href="#" th:href="@{/dashboard}">仪表盘</a>
			</div>
			<div class="title item" href="#">
				<i class="ion-ios-world titleIcon  icon"></i>业务概览
			</div>
			<div class="content">
			</div>
			<div class="title item">
				<i class="ion-mouse titleIcon icon"></i>设备监控<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#" th:href="@{/overview}">设备总览</a>
				<a class="item" href="#">设备详情</a>
			</div>
			<div class="title item" href="#">
				<i class="ion-arrow-graph-up-right titleIcon icon"></i>视图展示
			</div>
			<div class="content">
			</div>
			<div class="title item">
				<i class="ion-paintbrush titleIcon icon"></i>告警展示<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">告警日历</a>
				<a class="item" href="#">告警列表</a>
			</div>
			<div class="title item" href="#">
				<i class="ion-briefcase titleIcon icon"></i>报表统计
			</div>
			<div class="content">
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>仪表盘1</span>
			<i class="ion-speedometer icon"></i>
			<div class="menu">
				<div class="header">
					仪表盘1
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>业务概览</span>
			<i class="ion-ios-world icon"></i>
			<div class="menu">
				<div class="header">
					业务概览
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>设备监控</span>
			<i class="ion-mouse icon"></i>
			<div class="menu">
				<div class="header">
					设备监控
				</div>
				<div class="ui divider"></div>
				<a class="item" href="tab.html">设备总览</a>
				<a class="item" href="table.html">设备详情</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>视图展示</span>
			<i class="ion-arrow-graph-up-right icon"></i>
			<div class="menu">
				<div class="header">
					视图展示
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>告警展示</span>
			<i class="ion-paintbrush icon"></i>
			<div class="menu">
				<div class="header">
					告警展示
				</div>
				<div class="ui divider"></div>
				<a class="item" href="error.html">告警日历</a>
				<a class="item" href="error.html">告警列表</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>报表统计</span>
			<a href="error.html">
				<i class="ion-briefcase icon"></i>
			</a>
		</div>

		<div class="ui divider"></div>

	</div>

	<!--sidebar-->

	<div class="pusher">
		<!--navbar-->
		<div class="navslide navwrap" th:replace="layout::top_nav">
			<div class="ui menu icon borderless grid" data-color="inverted white">
				<a class="item labeled openbtn">
					<i class="ion-navicon-round big icon"></i>
				</a>
				<div class="item ui colhidden">
					<div class="ui icon input">
						<input type="text" placeholder="Search...">
						<i class="search icon"></i>
					</div>
				</div>
				<div class="right menu colhidden">
					<div class="ui dropdown item labeled icon">
						<i class="bell icon"></i>   告警
						<div class="ui red label mini circular">6</div>
						<div class="menu" >
							<div class="header">
								紧急告警
							</div>
							<div class="item">
								告警信息1……
								<div class="ui teal left pointing label">1</div>
							</div>
							<div class="item">
								告警信息2……
								<div class="ui label">51</div>
							</div>
							<div class="item">
								告警信息3……
								<div class="ui label">1</div>
							</div>
							<div class="header">
								严重告警
							</div>
							<div class="item">
								<i class="dropdown icon"></i>
								<span class="text">更多</span>
								<div class="menu">
									<div class="item">告警信息……</div>
									<div class="item">告警信息……</div>
								</div>
							</div>
						</div>
					</div>
					<div class="ui dropdown item">
                        <img class="ui mini circular image" src="../static/images/0.jpg" th:src="@{images/0.jpg}"
                             alt="label-image"/>
						<div class="menu">
							<a class="item" href="#" th:text="${session.userInfo.name}">whstone</a>
							<a class="item" href="mail.html" th:href="@{/logout}">注销</a>
						</div>
					</div>
					<a class="item labeled rightsidebar computer only">
						<i class="ion-wrench large icon"></i>工具
					</a>

				</div>
			</div>
		</div>
		<!--navbar-->
		<!--maincontent-->
		<div class="mainWrap navslide">
			<div class="ui equal width left aligned padded grid stackable">
				<!--Site Content-->
				<div class="sixteen wide column">
					<div class="ui segments">
						<div class="ui segment">
							<div class="ui secondary pointing menu">
								<a class="active item" data-tab="detail">业务概述</a>
								<a class="item" data-tab="tree">业务树</a>
								<a class="item" data-tab="report">业务图形报告</a>
								<div class="right menu">
									<select id="platform_select" class="ui mini dropdown ">
									</select>
								</div>
							</div>
							<div class="ui active tab segment noMargin fixedHeight" data-tab="detail">
								<div class="row">
									<div class="sixteen wide column">
										<div class="ui grid">
											<div class="six wide column">
												<div class="ui segment center aligned row1Height">
													<h2  class="ui left aligned header">健康度</h2>
													<div class="ui huge statistic" >
														<div class="value">
															<span id="health_value" class="counter">57.6</span> %
														</div>
													</div>
												</div>
											</div>
											<div class="ten wide column">
												<div class="ui segment left aligned row1Height">
													<div id="platform_graph" class="chartBar"></div>
												</div>
											</div>
											<div class="sixteen wide column">
												<div  class="ui segment" style="padding: 0px">
													<div class="ui grid">
														<div class="three wide column" style="padding-left: 15px;padding-right: 0px;">
															<div class="ui secondary vertical menu row2Height" id="hostsMenu">
																<a class="active item textOverflow">设备列表第一<i class="green desktop icon"></i></a>
																<a class="item textOverflow">设备列表第二<i class="red desktop icon"></i></a>
																<a class="item textOverflow">设备列表第一<i class="yellow desktop icon"></i></a>
																<a class="item textOverflow">设备列表第二</a>
																<a class="item textOverflow">设备列表第一</a>
																<a class="item textOverflow">设备列表第二</a>
																<a class="item textOverflow">设备列表第一</a>
																<a class="item textOverflow">设备列表第二</a>
															</div>
														</div>
														<div class="three wide column"  style="padding-left: 0px;">
															<div class="ui secondary vertical menu row2Height" id="pointsMenu" style="margin: 0px">
																<a class="active item">2A<i class="green circle icon"></i></a>
																<a class="item">2B<i class="red circle icon"></i></a>
																<a class="item">2A<i class="yellow circle icon"></i></a>
																<a class="item">2B</a>
																<a class="item">2A</a>
																<a class="item">2B</a>
																<a class="item">2A</a>
																<a class="item">2B</a>
															</div>
														</div>
														<div class="ten wide column">
															<div class="ui segment noBorder row2_3Height"  id="itemsMenu">
																<div class="ui grid">
																	<div class="row">
																		<div class="sixteen wide column">
																			<table class="ui very basic fixed single line table">
																				<thead>
																				<tr>
																					<th>名字</th>
																					<th>状态</th>
																					<th>值</th>
																					<th>权值</th>
																				</tr>
																				</thead>
																				<tbody id="itemsTable">
																				<tr>
																					<td>John</td>
																					<td title="Approved">Approved</td>
																					<td  title="None(超超超超超超超超超超超超超级长的文字)">None(超超超超超超超超超超超超超级长的文字)</td>
																				</tr>
																				<tr>
																					<td>Jamie</td>
																					<td>Approved</td>
																					<td>Requires call</td>
																				</tr>
																				<tr>
																					<td>Jill</td>
																					<td>Denied</td>
																					<td>None</td>
																				</tr>
																				<tr>
																					<td>Jamie</td>
																					<td>Approved</td>
																					<td>Requires call</td>
																				</tr>
																				<tr>
																					<td>Jamie</td>
																					<td>Approved</td>
																					<td>Requires call</td>
																				</tr>
																				<tr>
																					<td>Jamie</td>
																					<td>Approved</td>
																					<td>Requires call</td>
																				</tr>
																				<tr>
																					<td>Jamie</td>
																					<td>Approved</td>
																					<td>Requires call</td>
																				</tr>
																				</tbody>
																			</table>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="ui tab segment noMargin fixedHeight" data-tab="tree">
								<div class="row">
									<div class="ui grid">
										<div class="sixteen wide column">
											<div class="ui segment">
												<div id="c1"  class="sixteen wide column"></div>
											</div>
										</div>
										<div class="sixteen wide column">
											<div class="ui segment">
													详情
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="ui tab segment noMargin fixedHeight" data-tab="report">
								第三
							</div>
						</div>
					</div>
				</div>
				<!--Site Content-->
			</div>
		</div>
		<!--maincontent-->
	</div>
</div>
<th:block th:replace="layout::bottom_script(~{::supple})">
	<script src="../static/js/js.cookie.js" th:src="@{js/js.cookie.js}"></script>
	<script src="../static/js/jquery.nicescroll.min.js" th:src="@{js/jquery.nicescroll.min.js}"></script>
	<script data-pace-options='{ "ajax": false }' src="../static/js/pace.js" th:src="@{js/pace.js}"></script>
	<script src="../static/js/main.js" th:src="@{js/main.js}"></script>
	<th:block th:fragment="supple">
		<script type="text/javascript">

            //页面加载完加载基础数据
			$(function() {
                //初始化选项页
                $('.menu .item').tab();

                //初始化业务平台下拉框
                selectPlaltform();
                //加载健康度和图形数据
                getPlatDates();
				//加载分类菜单数据 诠释权值含义
				initWeightMenu();


			})

			//加载 业务平台 下拉框
			function selectPlaltform() {
                $.ajax({
                    async: false,
                    type: "get",
                    url: "/platformdetail/get_platforms",
                    dataType: "json",
                    success: function (result) {
                        if(result.success) {
                            var data=result.data;
                            var str = "";
                            for(var i=0;i<data.length;i++)
                            {
                                str +=" <option value='"+data[i].platform_id+"'  >"+data[i].platform_name+"</option> ";
                            }
                            //console.log("str:"+str);
                            $("#platform_select").html(str);
                            $("#platform_select").dropdown("set value", data[0].platform_id);
                            $("#platform_select").dropdown("set text", data[0].platform_name);
                        }
                        else {
                            errorMsg_no_data("业务平台 Dropdown");
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("业务平台 Dropdown");
                    }
                });
			}

            //加载健康度和图形数据
			function getPlatDates() {
                var platform_id = $("#platform_select").dropdown("get value")[0].split(",")[0];
                //console.log("platform_id:::" + platform_id);
                $.ajax({
                    type: "get",
                    url: "/platformdetail/get_datas?platform_id="+platform_id,
                    dataType: "json",
                    success: function (result) {
                        if(result.success) {
                            var platform_data = result.data;
							$("#health_value").text(platform_data.health);
                            //绘制图标数据
                            var platform_chart = echarts.init(document.getElementById("platform_graph"));
                            //配置option
                            var option = {
                                title: {
                                    show:true,
                                    text: '',
                                    top:'-5px'
                                },
                                tooltip : {
                                    trigger: 'axis',
                                    axisPointer : {
                                        type : false
                                    }
                                },
                                grid: {
                                    left: '2%',
                                    right: '2%',
                                    bottom: '2%',
                                    top:'2%',
                                    containLabel: true
                                },
                                xAxis:  {
                                    type: 'category',
                                    data: platform_data.types
                                },
                                yAxis: {
                                    type: 'value',
                                    splitLine:{show: false},
                                },
                                series: [
                                    {
                                        name: '正常',
                                        type: 'bar',
                                        stack: '设备总数',
                                        barWidth : 25,
                                        label: {
                                            normal: {
                                                show: true,
                                                position: 'insideRight'
                                            }
                                        },
                                        data: platform_data.datas[0],
                                        color: ['#5FB878']
                                    },
                                    {
                                        name: '警告',
                                        type: 'bar',
                                        stack: '设备总数',
                                        barWidth : 25,
                                        label: {
                                            normal: {
                                                show: true,
                                                position: 'insideRight'
                                            }
                                        },
                                        data: platform_data.datas[1],
                                        color: ['#F7B824']
                                    },
                                    {
                                        name: '严重',
                                        type: 'bar',
                                        stack: '设备总数',
                                        barWidth : 25,
                                        label: {
                                            normal: {
                                                show: true,
                                                position: 'insideRight'
                                            }
                                        },
                                        data: platform_data.datas[2],
                                        color: ['#DB2828']
                                    }
                                ]
                            };
                            //根据配置绘制图形
                            platform_chart.setOption(option);
                        }
                        else {
                            errorMsg_no_data("业务平台基础数据获取 失败");
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("服务器连接 失败");
                    }
                });
			}

            //加载分类菜单数据 诠释权值含义
			function initWeightMenu() {
                var platform_id = $("#platform_select").dropdown("get value")[0].split(",")[0];
                //加载设备列表
                hostsMenu(platform_id);
				//加载监控点列表
                var host_id = $("#hostsMenu").children(".item.textOverflow.active").attr("id");
                //console.log("host_id:::" + host_id);
                pointsMenu(host_id);
				//加载监控项列表
                var point_id = $("#pointsMenu").children(".item.textOverflow.active").attr("id");
                //console.log("point_id:::" + point_id);
                itemsMenu(point_id);
			}
			//加载设备列表
            function hostsMenu(platform_id) {
                $.ajax({
                    async: false,
                    type: "get",
                    url: "/platformdetail/get_hosts?platform_id="+platform_id,
                    dataType: "json",
                    success: function (result) {
                        if(result.success) {
                            var data = result.data;
                            gethostsMenu(data);
                            $('#hostsMenu a').on('click',function () {
                                $('#hostsMenu a').removeClass('active');
                                $(this).addClass('active');
                                pointsMenu(this.id);
                            })
                        }
                        else {
                            errorMsg_no_data("设备列表 Menu");
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("设备列表 Menu");
                    }
                })
            }
            function gethostsMenu(data) {
                var str = '';
                for(var i=0;i<data.length;i++)
                {
                    if (i==0){
                        str +="<a class='item textOverflow active' id='"+data[i].host_id+"' >"+data[i].host_name+"</a> ";
                    }else {
                        str +="<a class='item textOverflow' id='"+data[i].host_id+"' >"+data[i].host_name+"</a> ";
                    }
                }
                $("#hostsMenu").html("");
                $("#hostsMenu").html(str);
            }

            //加载监控点列表
            function pointsMenu(host_id) {
                $.ajax({
                    async: false,
                    type: "get",
                    url: "/platformdetail/get_points?host_id="+host_id,
                    dataType: "json",
                    success: function (result) {
                        if(result.success) {
                            var data = result.data;
                            getpointsMenu(data);
                            $('#pointsMenu a').on('click',function () {
                                $('#pointsMenu a').removeClass('active');
                                $(this).addClass('active');
                                itemsMenu(this.id);
                            })
                        }
                        else {
                            errorMsg_no_data("监控点列表 Menu");
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("监控点列表 Menu");
                    }
                })
            }
            function getpointsMenu(data) {
                var str = '';
                for(var i=0;i<data.length;i++)
                {
                    if (i==0){
                        str +="<a class='item textOverflow active' id='"+data[i].point_id+"' >"+data[i].point_name+"</a> ";
                    }else {
                        str +="<a class='item textOverflow' id='"+data[i].point_id+"' >"+data[i].point_name+"</a> ";
                    }
                }
                $("#pointsMenu").html("");
                $("#pointsMenu").html(str);
            }

            //加载监控项列表
            function itemsMenu(point_id) {
                $.ajax({
                    type: "get",
                    url: "/platformdetail/get_items?point_id="+point_id,
                    dataType: "json",
                    success: function (result) {
                        if(result.success) {
                            var data = result.data;
                            getitemsMenu(data);
                        }
                        else {
                            errorMsg_no_data("监控项列表 Menu");
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("监控项列表 Menu");
                    }
                })
            }
            function getitemsMenu(data) {
                var str = '';
                for(var i=0;i<data.length;i++)
                {
                    str +="<tr id='"+data[i].item_id+"' ><td>"
                        +data[i].item_name +"</td><td> "
                        +data[i].state+"</td><td> "
                        +data[i].value+"</td><td> "
                        +data[i].weight+"</td></tr> ";
                }
                $("#itemsTable").html("");
                $("#itemsTable").html(str);
            }

//            //健康度线状图
//            var myChart = echarts.init(document.getElementById('platformHealth'));
//            var option = {
//                xAxis: {
//                    data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
//                },
//                yAxis: {},
//                series: [{
//                    name: '销量',
//                    type: 'line',
//                    data: [5, 20, 36, 10, 10, 20]
//                }]
//            };
//            myChart.setOption(option);

            //紧凑树图
			$.getJSON('../../../static/data/g6-npm-ls-tiny-tree.json',function(data){
				var tree = new G6.Tree({
					id: 'c1',
					width: 1000,
					height: 240 ,
					fitView: 'autoZoom',
					layoutCfg: {
						direction: 'TB',
						getHGap: function(/* d */) {
							return 10;
						},
						getVGap: function(/* d */) {
							return 50;
						},
					},
				});
				//tree.source(data);
				tree.source({
					label: 'G6',
					children: [{
						label: '图类',
						children: [
							{
								label: 'Graph'
							},
							{
								label: 'Net'
							},
							{
								label: 'Tree'
							},
							{
								label: '……'
							}
						]
					},
						{
							label: '基础类',
							//isCollapsed: true,
							children: [
								{
									label: 'Canvas'
								},
								{
									label: 'Handler'
								},
								{
									label: 'Layout'
								},
								{
									label: 'Global'
								}
							]
						},
						{
							label: '工具类',
							children: [
								{
									label: 'Matrix',
									color: 'red',
									id:'000'
								},
								{
									label: 'Color'
								},
								{
									label: 'Util',
									size: 30
								}
							]
						}]
				});
				tree.node()
					.label(function (obj) {
						return obj.name;
					})
					.style({
						fillOpacity: 1
					})
				tree.edge().shape('smooth');
				tree.render();
				tree.on('click', function(ev){
					alert("击中" + ev.item.get('model').id + "!");
				});
			});

            //告警消息
            function errorMsg_no_connect(title) {
                Lobibox.notify("error", {
                    size: "normal",
                    rounded: false,
                    delayIndicator: true,
                    msg: "连接服务器失败！",
                    icon: "warning icon",
                    title: title
                });
            }
            function errorMsg_no_data(title) {
                Lobibox.notify("error", {
                    size: "normal",
                    rounded: false,
                    delayIndicator: true,
                    msg: "解析数据失败！",
                    icon: "warning icon",
                    title: title
                });
            }
		</script>

	</th:block>
</th:block>

</body>
</html>