<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html>
<head th:replace="layout::common_head(~{::title}, ~{::supplement})">
    <meta charset="UTF-8">
    <title>轮播视图</title>
    <script src="../static/js/jquery-3.2.1.min.js" th:src="@{js/jquery-3.2.1.min.js}"></script>
    <script src="../static/js/semantic.js" th:src="@{js/semantic.js}"></script>
    <link rel="stylesheet" href="../static/css/semantic.css" th:href="@{/css/semantic.css}"/>
    <link rel="stylesheet" href="../static/css/icon.css" th:href="@{css/icon.css}"/>
    <link href="../static/css/ionicons.min.css" rel="stylesheet" th:href="@{css/ionicons.min.css}"/>
    <link href="../static/css/main.css" rel="stylesheet" th:href="@{css/main.css}"/>
    <link href="../static/css/pace.css" rel="stylesheet" th:href="@{css/pace.css}"/>
    <link href="../static/css/lobibox.css" rel="stylesheet" th:href="@{css/lobibox.css}"/>
    <th:block th:fragment="supplement">
        <script src="http://rapapi.org/rap.plugin.js?projectId=19544&mode=3"></script>
        <script src="../static/js/echarts.min.js" th:src="@{js/echarts.min.js}"></script>
        <script src="../static/js/jstree.min.js" th:src="@{js/jstree.min.js}"></script>
        <link rel="stylesheet" href="../static/css/jstree-default/style.min.css"
              th:href="@{css/jstree-default/style.min.css}">
        <link rel="stylesheet" type="text/css" href="../static/css/jquery.gridster.css"
              th:href="@{css/jquery.gridster.css}">
        <script src="../static/js/jquery.gridster.js" th:src="@{js/jquery.gridster.js}" type="text/javascript" charset="utf-8"></script>
        <style type="text/css">
            /*li {background:yellow;}*/
            .detail { padding-top: 10px;padding-right: 5px;margin-left: 5px }
        </style>
    </th:block>
</head>
<body>
<!--header start-->
<div id="contextWrap">
    <!--sidebar-->
    <div class="ui sidebar vertical left menu overlay  borderless visible sidemenu inverted  grey" data-color="grey"
         th:replace="layout::left_menu">
        <a class="item logo" href="#">
        </a>
        <div class="ui accordion inverted">
            <div class="title item">
                <i class="ion-speedometer titleIcon icon"></i>仪表盘
            </div>
            <div class="content">
                <a class="item" href="#" th:href="@{/dashboard}">仪表盘</a>
            </div>
            <div class="title item" href="#">
                <i class="ion-ios-world titleIcon  icon"></i>业务概览
            </div>
            <div class="content">
            </div>
            <div class="title item">
                <i class="ion-mouse titleIcon icon"></i>设备监控<i class="dropdown icon"></i>
            </div>
            <div class="content">
                <a class="item" href="#" th:href="@{/overview}">设备总览</a>
                <a class="item" href="#">设备详情</a>
            </div>
            <div class="title item" href="#">
                <i class="ion-arrow-graph-up-right titleIcon icon"></i>视图展示
            </div>
            <div class="content">
            </div>
            <div class="title item">
                <i class="ion-paintbrush titleIcon icon"></i>告警展示<i class="dropdown icon"></i>
            </div>
            <div class="content">
                <a class="item" href="#">告警日历</a>
                <a class="item" href="#">告警列表</a>
            </div>
            <div class="title item" href="#">
                <i class="ion-briefcase titleIcon icon"></i>报表统计
            </div>
            <div class="content">
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>仪表盘1</span>
            <i class="ion-speedometer icon"></i>
            <div class="menu">
                <div class="header">
                    仪表盘1
                </div>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>业务概览</span>
            <i class="ion-ios-world icon"></i>
            <div class="menu">
                <div class="header">
                    业务概览
                </div>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>设备监控</span>
            <i class="ion-mouse icon"></i>
            <div class="menu">
                <div class="header">
                    设备监控
                </div>
                <div class="ui divider"></div>
                <a class="item" href="tab.html">设备总览</a>
                <a class="item" href="table.html">设备详情</a>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>视图展示</span>
            <i class="ion-arrow-graph-up-right icon"></i>
            <div class="menu">
                <div class="header">
                    视图展示
                </div>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>告警展示</span>
            <i class="ion-paintbrush icon"></i>
            <div class="menu">
                <div class="header">
                    告警展示
                </div>
                <div class="ui divider"></div>
                <a class="item" href="error.html">告警日历</a>
                <a class="item" href="error.html">告警列表</a>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>报表统计</span>
            <a href="error.html">
                <i class="ion-briefcase icon"></i>
            </a>
        </div>

        <div class="ui divider"></div>

    </div>

    <!--sidebar-->

    <div class="pusher">
        <!--navbar-->
        <div class="navslide navwrap" th:replace="layout::top_nav">
            <div class="ui menu icon borderless grid" data-color="inverted white">
                <a class="item labeled openbtn">
                    <i class="ion-navicon-round big icon"></i>
                </a>
                <div class="item ui colhidden">
                    <div class="ui icon input">
                        <input type="text" placeholder="Search...">
                        <i class="search icon"></i>
                    </div>
                </div>
                <div class="right menu colhidden">
                    <div class="ui dropdown item labeled icon">
                        <i class="bell icon"></i> 告警
                        <div class="ui red label mini circular">6</div>
                        <div class="menu">
                            <div class="header">
                                紧急告警
                            </div>
                            <div class="item">
                                告警信息1……
                                <div class="ui teal left pointing label">1</div>
                            </div>
                            <div class="item">
                                告警信息2……
                                <div class="ui label">51</div>
                            </div>
                            <div class="item">
                                告警信息3……
                                <div class="ui label">1</div>
                            </div>
                            <div class="header">
                                严重告警
                            </div>
                            <div class="item">
                                <i class="dropdown icon"></i>
                                <span class="text">更多</span>
                                <div class="menu">
                                    <div class="item">告警信息……</div>
                                    <div class="item">告警信息……</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui dropdown item">
                        <img class="ui mini circular image" src="../static/images/0.jpg" th:src="@{images/0.jpg}"
                             alt="label-image"/>
                        <div class="menu">
                            <a class="item" href="#" th:text="${session.userInfo.name}">whstone</a>
                            <a class="item" href="mail.html" th:href="@{/logout}">注销</a>
                        </div>
                    </div>
                    <a class="item labeled rightsidebar computer only">
                        <i class="ion-wrench large icon"></i>工具
                    </a>

                </div>
            </div>
        </div>
        <!--navbar-->
        <!--maincontent-->
        <div class="mainWrap navslide">
            <div class="ui equal width left aligned padded grid stackable">
                <!--Site Content-->
                <div class="sixteen wide column">
                    <div class="header item">
                        <h2><i class="bar large chart icon"></i>轮播视图</h2>
                    </div>
                    <div class="ui grid">
                        <div class="eight wide column"  style="padding-bottom: 0px">
                            <div id="viewgroup_select" class="ui selection dropdown">
                                <i class="dropdown icon"></i>
                                <div class="text"></div>
                                <div class="menu" id="viewgroup_menu">

                                </div>
                            </div>
                            <div id="viewpage_select" class="ui selection dropdown">
                                <!--<input type="hidden" name="hosts">-->
                                <i class="dropdown icon"></i>
                                <div class="text"></div>
                                <div class="menu"  id="viewpage_menu">

                                </div>
                            </div>
                        </div>
                        <div class="eight wide column right aligned"  style="padding-bottom: 0px">
                            <button class="ui basic button addpage"><i class="add icon"></i> 添加</button>
                            <button class="ui basic button writepage"><i class="write icon"></i> 修改</button>
                            <button class="ui basic button deletepage"><i class="delete icon"></i> 删除</button>
                            <button class="ui blue button editpage"><i class="edit icon"></i> 编辑</button>
                            <button class="ui blue button refreshpage"><i class="refresh icon"></i> 刷新</button>
                            <button class="ui blue button savepage"><i class="save  icon"></i> 保存</button>
                        </div>
                    </div>

                    <div class="ui segment" style=" min-height : 470px;" >
                        <div class="ui grid">
                            <div class="one wide column">
                                <div style="height: 10px"></div>
                                <button class="ui icon basic massive button addblock " style="box-shadow:0px 0px;border:3px dashed darkgray;width: 70px"><!--// -->
                                    <i class="add icon" style="font-size:200%;padding-top: 10px;padding-right:30px "></i>
                                </button>
                            </div>
                            <div class="fifteen wide column" style="padding-top: 0px">
                                <div class="gridster">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Site Content-->
            </div>
        </div>
        <!--maincontent-->
        <!--添加展示组弹出框 start-->
        <div class="ui tiny modal page" id="group_modal">
            <i class="close icon"></i>
            <div class="header">
                添加展示组
            </div>
            <div class="ui content  center aligned basic segment no-padding">
                <form class="ui form">
                    <div class="required inline field ">
                        <label>名称</label>
z                    </div>
                    <div class="required inline field">
                        <label>刷新</label>
                        <input type="text" placeholder="刷新频率（分钟）">
                    </div>
                    <div class="required inline field">
                        <label>描述</label>
                        <input type="text" placeholder="不能为空">
                    </div>
                </form>
            </div>
            <div class="actions">
                <div class="ui approve submit button">确认</div>
                <div class="ui cancel button">取消</div>
            </div>
        </div>
        <!--添加展现页弹出框 start-->
        <div class="ui tiny modal page" id="page_modal">
            <i class="close icon"></i>
            <div class="header">所属【展示组】的页面</div>
            <div class="ui content  center aligned basic segment">
                <form class="ui form">
                    <div class="required inline field " id="page_name_field">
                        <label>名称</label>
                        <input type="text" placeholder="不能为空" id="page_name">
                    </div>
                    <!--<div class="inline field">
                        <label>描述</label>
                        <textarea></textarea>
                    </div>-->
                </form>
            </div>
            <div class="actions">
                <div class="ui approve submit button">确认</div>
                <div class="ui cancel button">取消</div>
            </div>
        </div>
        <!--添加展示点类型弹出框 start-->
        <div class="ui tiny modal page" id="point_modal">
            <i class="close icon"></i>
            <div class="header">
                选择视图类型
            </div>
            <div class="ui content  center aligned basic segment no-padding">
                <div class="ui vertical buttons">
                    <button class="ui view button">添加视图</button>
                    <button class="ui group button">添加图表</button>
                    <button class="ui chart button">添加数值</button>
                </div>
            </div>
        </div>
        <!--添加展示项添加视图弹出框 start-->
        <div class="ui tiny modal page" id="point_view_modal">
            <i class="close icon"></i>
            <div class="header">
                添加视图
            </div>
            <div class="ui content  center aligned basic segment no-padding">
                <form class="ui form">
                    <div class="required inline field ">
                        <label>视图类型</label>
                        <div class="ui selection dropdown">
                            <!--<input type="hidden" name="hosts">-->
                            <i class="dropdown icon"></i>
                            <div class="text">状态统计</div>
                            <div class="menu" >
                                <div class="selected item">状态统计</div>
                                <div class="item">问题视图</div>
                            </div>
                        </div>
                    </div>
                    <div class="required inline field ">
                        <label>选择页面</label>
                        <div class="ui selection dropdown">
                            <!--<input type="hidden" name="hosts">-->
                            <i class="dropdown icon"></i>
                            <div class="text">默认页面</div>
                            <div class="menu" >
                                <div class="selected item">默认页面</div>
                                <div class="item">默认页面1</div>
                                <div class="item">默认页面2</div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="actions">
                <div class="ui approve submit button">确认</div>
                <div class="ui cancel button">取消</div>
            </div>
        </div>
        <!--添加展示项添加图表弹出框 start-->
        <div class="ui small modal page" id="point_group_modal">
            <i class="close icon"></i>
            <div class="ui horizontal segments" style="border: none;box-shadow:0px 0px;">
                <div class="ui segment">
                    <div id="host_tree"></div>
                    <button class="ui blue button" id="host_tree_button">单选确认</button>
                </div>
                <div class="ui segment no-padding">
                    <div class="ui middle aligned selection list" id="pointsMenu">
                        <div class="item">
                            <i class="green circle icon"></i>
                            <div class="content">
                                <div class="header">选择监控点</div>
                            </div>
                        </div>
                        <div class="item">
                            <i class="yellow circle icon"></i>
                            <div class="content">
                                <div class="header">选择监控点</div>
                            </div>
                        </div>
                        <div class="item">
                            <i class="red circle icon"></i>
                            <div class="content">
                                <div class="header">选择监控点</div>
                            </div>
                        </div>
                        <div class="item">
                            <i class="yellow circle icon"></i>
                            <div class="content">
                                <div class="header">选择监控点</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ui segment no-padding">
                    <div class="ui middle aligned selection list" id="itemsMenu">
                        <div class="item">
                            <i class="yellow square icon"></i>
                            <div class="content">
                                <div class="header">选择监控项</div>
                            </div>
                        </div>
                        <div class="item">
                            <i class="yellow square icon"></i>
                            <div class="content">
                                <div class="header">选择监控项</div>
                            </div>
                        </div>
                        <div class="item">
                            <i class="red square icon"></i>
                            <div class="content">
                                <div class="header">选择监控项</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ui segment no-padding">
                    <div class="ui middle aligned selection list" id="typeMenu">
                        <div class="item">
                            <i class="line icon"></i>
                            <div class="content">
                                <div class="header">选择图形</div>
                            </div>
                        </div>
                        <div class="item">
                            <i class="bar icon"></i>
                            <div class="content">
                                <div class="header">选择图形</div>
                            </div>
                        </div>
                        <div class="item">
                            <i class="area icon"></i>
                            <div class="content">
                                <div class="header">选择图形</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="actions">
                <div class="ui approve submit button">确认</div>
                <div class="ui cancel button">取消</div>
            </div>
        </div>
        <!--添加展示项添加静态数据弹出框 start-->
        <div class="ui tiny modal page" id="point_chart_modal">
            <i class="close icon"></i>
            <div class="header">
                添加静态数据
            </div>
            <div class="ui content  center aligned basic segment no-padding">
                <form class="ui form">
                    <div class="required inline field">
                        <label>图&nbsp&nbsp&nbsp&nbsp形</label>
                        <div class="ui selection dropdown" id="static_select">
                            <!--<input type="hidden" name="hosts">-->
                            <i class="dropdown icon"></i>
                            <div class="text">时钟</div>
                            <div class="menu" >
                                <div class="selected item" data-value="clock">时钟</div>
                                <div class="item" data-value="table">表格</div>
                            </div>
                        </div>
                    </div>
                    <div class="required inline field">
                        <label>名&nbsp&nbsp&nbsp&nbsp称</label>
                        <input type="text" placeholder="不能为空" style="width: 168px;">
                    </div>
                    <div class="required inline field"  id="clock_type">
                        <label>类&nbsp&nbsp&nbsp&nbsp型</label>
                        <div class="ui selection dropdown">
                            <!--<input type="hidden" name="hosts">-->
                            <i class="dropdown icon"></i>
                            <div class="text">数值</div>
                            <div class="menu" >
                                <div class="selected item">数值</div>
                                <div class="item">钟表</div>
                            </div>
                        </div>
                    </div>
                    <div class="required inline field" id="table_type" style="display:none;">
                        <div class="ui label no-padding">
                            <input type="text" placeholder="1" style="width: 80px;">
                            <div class="detail">行</div>
                        </div>
                        <div class="ui label no-padding">
                            <input type="text" placeholder="1" style="width: 80px;">
                            <div class="detail">列</div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="actions">
                <div class="ui approve submit button">确认</div>
                <div class="ui cancel button">取消</div>
            </div>
        </div>
        <!--添加表头详情，展示项添加静态数据弹出框 start-->
        <div class="ui tiny modal page" id="table_thead_modal">
            <i class="close icon"></i>
            <div class="header">
                添加表头
            </div>
            <div class="ui content  center aligned basic segment no-padding">
                <form class="ui form">
                    <div class="ui label no-padding">
                        <div class="detail">第1列</div>
                        <input type="text" style="width: 180px;">
                    </div>
                    <div class="ui label no-padding">
                        <input type="text" placeholder="180" style="width: 80px;">
                        <div class="detail">PX</div></div>
                    <div class="ui label no-padding">
                        <div class="detail">第1列</div>
                        <input type="text" style="width: 180px;">
                    </div>
                    <div class="ui label no-padding">
                        <input type="text" placeholder="180" style="width: 80px;">
                        <div class="detail">PX</div>
                    </div>
                </form>
            </div>
            <div class="actions">
                <div class="ui approve submit button">继续</div>
            </div>
        </div>
        <!--添加表内容详情，展示项添加静态数据弹出框 start-->
        <div class="ui tiny modal page" id="table_tbody_modal">
            <i class="close icon"></i>
            <div class="header">
                添加表详情
            </div>
            <div class="ui content  center aligned basic segment">
                <!--<div id="jsGrid"></div>-->
                <table id="data_table" class="ui compact selectable striped celled table tablet stackable" cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Name</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="actions">
                <div class="ui approve submit button">确认</div>
                <div class="ui cancel button">取消</div>
            </div>
        </div>
        <!--删除页面弹出框 start-->
        <div class="ui tiny modal delete" id="delete_modal">
            <div class="ui icon header">
                <i class="trash icon"></i>
                确定删除本页面吗？
            </div>
            <div class="actions">
                <div class="ui approve submit button" data-tooltip="提示：该操作无法恢复！" data-inverted="">确认</div>
                <div class="ui cancel button">取消</div>
            </div>
        </div>
    </div>
</div>

<th:block th:replace="layout::bottom_script(~{::specialScript})">
    <script src="../static/js/js.cookie.js" th:src="@{js/js.cookie.js}"></script>
    <script src="../static/js/jquery.nicescroll.min.js" th:src="@{js/jquery.nicescroll.min.js}"></script>
    <script data-pace-options='{ "ajax": false }' src="../static/js/pace.js" th:src="@{js/pace.js}"></script>
    <script src="../static/js/main.js" th:src="@{js/main.js}"></script>
    <th:block th:fragment="specialScript">
        <script src="../static/js/jquery.dataTables.js" th:src="@{js/jquery.dataTables.js}"></script>
        <script src="../static/js/custom-datatable.js" th:src="@{js/custom-datatable.js}"></script>
        <script src="../static/js/assistantTool.js" th:src="@{js/assistantTool.js}"></script>
        <script src="../static/js/custom/choose-hosts.js" th:src="@{js/custom/choose-hosts.js}"></script>
        <script src="../static/js/custom/carousel-common.js" th:src="@{js/custom/carousel-common.js}"></script>
        <script  type="text/javascript">
            var _gridster;

            var page_vos; //同一个展示组的所有页面数据
            var page_vo ;//单个展示页面数据
            
            //定义echart图表
            var Color = ['#5FB878', '#F7B824', '#f11111','#d2d2d2', '#2F4056'];
            var host_option={
                title: {
                    text: '0',
                    subtext: '台设备',
                    x: 'center',
                    y: 'center',
                    itemGap: 1,
                    textStyle: {
                        color: '#01AAED',
                        fontFamily: '微软雅黑',
                        fontSize: 24,
                        fontWeight: 'bolder'
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                    orient: 'vertical',
                    x: 'right',
                    y: 'center',
                    data:['正常','警告','严重'],
                },
                grid: {
                    left:'5%',
                    right:'5%',
                },
                series: [
                    {
                        name: '访问来源',
                        type: 'pie',
                        radius: ['40%', '65%'],
                        selectedMode: '',
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    formatter: function (param) {
                                        return param.name + param.value + "台" + ':\n' + Math.round(param.percent) + '%';
                                    },
                                    textStyle: {
                                        fontWeight: 'bolder'
                                    }
                                }
                            },
                        },
                        data:  [
                            {
                                "value": 2,
                                "name": "正常,"
                            },
                            {
                                "value": 7,
                                "name": "警告"
                            }
                        ],
                        color: Color
                    }
                ]
            };
            var point_option = {
                title: {
                    text: '0',
                    subtext: '个监控点',
                    x: 'center',
                    y: 'center',
                    itemGap: 1,
                    textStyle: {
                        color: '#01AAED',
                        fontFamily: '微软雅黑',
                        fontSize: 24,
                        fontWeight: 'bolder'
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                    orient: 'vertical',
                    x: 'right',
                    y: 'center',
                    data:['正常','警告','严重'],
                },
                grid: {
                    left:'15%',
                    right:'15%',
                },
                series: [
                    {
                        name: '访问来源',
                        type: 'pie',
                        radius: ['40%', '65%'],
                        selectedMode: '',
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    formatter: function (param) {
                                        return param.name + param.value + "个" + ':\n' + Math.round(param.percent) + '%';
                                    },
                                    textStyle: {
                                        fontWeight: 'bolder'
                                    }
                                }
                            },
                        },
                        data:  [
                            {
                                "value": 5,
                                "name": "正常"
                            },
                            {
                                "value": 5,
                                "name": "警告"
                            }
                        ],
                        color: Color
                    }
                ]
            }

            $(function() {
                //初始化组下拉框
                getSelectGroup();
                var group_name = $('#viewgroup_select').dropdown('get value');
                getSelectPage(group_name);
                drawAllPageByGroupName(group_name);

            })

            //默认隐藏编辑展示项框
            $("button.addblock").hide();

            $('#viewpage_select').dropdown({
                onChange: function(value) {
                    //$('viewpage_select').addClass('loading disable');
                    var page_name = value;
                    console.log('page_vos',page_vos);
                    for(var i=0;i<page_vos.length;i++) {
                        if(page_vos[i].page_name === page_name) {
                            $('.section').eq(i).show();
                        }else {
                            $('.section').eq(i).hide();
                        }
                        console.log('css',$('.section').eq(i).attr('class'));
                    }
                }
            })

            $('#static_select').dropdown({
                onChange: function (value) {
                    if (value=="clock"){
                        $("#table_type").hide();
                        $("#clock_type").show();
                    }else if (value=="table"){
                        $("#table_type").show();
                        $("#clock_type").hide();
                    }
                }
            })

            function drawAllPageByGroupName(groupName) {
                console.log('groupName',groupName);
                $.ajax({
                    async: false,
                    type: 'get',
                    url: '/carousel/get_alldata?group_name=' + groupName,
                    dataType: 'json',
                    success: function (result) {
                        if(result.success) {
                            page_vos = result.data;
                            $('.gridster').html('');
                            //gridster.remove_all_widgets();
                            for(var i=0;i < page_vos.length;i++) {
                                $('.gridster').append('<div class="section" ><ul></ul></div>');
                                _gridster = $('.section:eq(' + i + ') ul').gridster({
                                    widget_selector: 'li',
                                    widget_margins: [50, 50],                       //margin大小
                                    widget_base_dimensions: [100, 100],             //网格粒度
                                    avoid_overlapped_widgets: true,  //不允许widgets加载的时候重叠
                                    max_cols: 15,                             //最多创建多少列，null表示没有限制
                                    max_rows: 10,                             //最多创建多少横，null表示没有限制
                                    min_cols: 1,                                //至少创建多少列
                                    min_rows: 1,                               //至少创建多少横
                                    resize: {
                                        enabled: true,
                                        max_size: [4, 4],
                                        min_size: [1, 1]
                                    }
                                }).data('gridster');
                                drawPage(_gridster,page_vos[i],i);
                            }
                        }
                        else {
                            errorMsg_no_data(result.message);
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("获取展示组下所有展示页失败 ajax");
                    }
                })
            }

            //初始化组下拉框
            function getSelectGroup() {
                $.ajax({
                    async: false,
                    type: 'get',
                    url: '/carousel/get_groups',
                    dataType: 'json',
                    success: function (result) {
                        if(result.success) {
                            var data=result.data;
                            getSelectByString($('#viewgroup_menu'),$('#viewgroup_select'),data);
                        }
                        else {
                            errorMsg_no_data(result.message);
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("展示组下拉框 Dropdown");
                    }
                })
            }

            //初始化展示页下拉框
            function getSelectPage(group_name) {
                $.ajax({
                    type: 'get',
                    url: '/carousel/get_pages?group_name=' + group_name,
                    dataType: 'json',
                    success: function (result) {
                        if(result.success) {
                            var data=result.data;
                            getSelectByString($('#viewpage_menu'),$('#viewpage_select'),data);
                        }
                        else {
                            errorMsg_no_data(result.message);
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("展示页下拉框 Dropdown");
                    }
                })
            }

//            $('#viewgroup_select').dropdown({
//                   onChange: function (value) {
//                       //$('#viewgroup_select').addClass('loading disabled');
//                       getSelectPage(value);
//                   }
//            })

            //绘制状态统计视图
            function getViewStatepie(host_chart,point_chart,data) {
                //console.log("state-data",data);
                var hostStateNum = data.hostStateNum;
                if (hostStateNum.stateNum) {
                    host_option.title.text = hostStateNum.totalNum;
                    host_option.series[0].data = hostStateNum.stateNum;
                    // 重写指定图表的配置项和数据
                    host_chart.setOption(host_option);
                }
                var pointStateNum = data.pointStateNum;
                if (pointStateNum.stateNum) {
                    point_option.title.text = pointStateNum.totalNum;
                    point_option.series[0].data = pointStateNum.stateNum;
                    point_chart.setOption(point_option);
                }
            }

            //一个页面一个页面的绘制  index表示第几个页面
            function drawPage(gridster,page_vo,index) {

                //console.log('index',index);

                $.each(page_vo.layout_data, function () {
                    gridster.add_widget('<li>', this.size_x, this.size_y, this.col, this.row);
                });
                //画图
                var layout_arr = page_vo.layout_data;
                var config_arr = page_vo.config_data;
                var block_arr = page_vo.block_data;
//                console.log("layout_data",layout_arr);
//                console.log('config_data',config_arr);
//                console.log('block_data',block_arr);
                for(var i = 0 ;i < layout_arr.length; i++) {
                    //根据配置画图
                    if(config_arr[i].block_type === 'view') {
                        //视图
                        if(config_arr[i].graph_type === 'statepie') {
                            //状态视图
                            $('.section:eq(' + index + ') li').eq(i).html('');

                            $('.section:eq(' + index + ') li').eq(i).append(
                                '<div style="width: 430px;height: 150px;" >' +
                                    '<div style="width: 100%;height: 10%;"></div>' +
                                    '<div style="float:left;width: 45%;height: 80%;" id="host_pie'+ index + i +'"></div >' +
                                    '<div style="float:left;width: 45%;height: 80%;" id="point_pie'+ index + i +'"></div>' +
                                '</div>');

                            var host_chart = echarts.init(document.getElementById('host_pie'+ index +i));

                            var point_chart = echarts.init(document.getElementById('point_pie'+ index +i));

                            getViewStatepie(host_chart,point_chart,block_arr[i]);

                        }else if(config_arr[i].graph_type === 'problems') {
                            //问题视图
                            $('.section:eq(' + index + ') li').eq(i).append('<table id="problems_'+ index + i +'"></table>');
                            //var problemTable = $('#problems_'+i).problemTable();

                            var problemTable = $('#problems_'+ index +i).DataTable({
                                "info": false,
                                "searching": false,
                                "lengthChange": false,
                                "paging":false,
                                createdRow: function (row, rowData) {
                                    $('td', row).eq(1).addClass('left aligned');
                                    $('td', row).eq(2).addClass('left aligned');
                                    if (rowData.problem_state === '问题') {
                                        if (rowData.priority_state === '警告') {
                                            row.classList.add("warning")
                                        } else if (rowData.priority_state === '严重') {
                                            row.classList.add("negative")
                                        } else {
                                        }
                                    }
                                },
                                data: [],
                                columns: [
                                    {
                                        "data": "problem_time",
                                        "width": "25%",
                                        "title": "发生时间",
                                        "orderable": false,

                                    },
                                    {
                                        "data": "host_name",
                                        "width": "10%",
                                        "title": "设备",
                                        "orderable": false,
                                    },
                                    {
                                        "data": "description",
                                        "width": "20%",
                                        "title": "问题",
                                        "orderable": false
                                    },
                                    {
                                        "data": "priority_state",
                                        "width": "10%",
                                        "title": "级别",
                                        "orderable": false,
                                    },
                                    {
                                        "data": "problem_state",
                                        "width": "10%",
                                        "title": "状态",
                                        "orderable": false,
                                    },
                                    {
                                        "data": "duration_string",
                                        "width": "15%",
                                        "title": "持续时间",
                                        "orderable": false,
                                    },
                                    {
                                        "data": "alert_state",
                                        "width": "10%",
                                        "title": "告警状态",
                                        "orderable": false,
                                    },
                                    {
                                        "data": "acknowledged",
                                        "width": "10%",
                                        "title": "确认",
                                        "orderable": false,
                                    }
                                ]
                            });

                            //console.log('block_arr[i].problems',block_arr[i].problems);

                            problemTable.rows.add(block_arr[i].problems).draw();

                            //待完成
                        }else if(config_arr[i].graph_type === 'appletree') {
                            //苹果树
                        }else {

                        }
                    }else if(config_arr[i].block_type === 'graph') {
                        //图表
                        graph_vo = block_arr[i];
                        //渲染图形
                        $('.section:eq(' + index + ') li').eq(i).append(
                            '<div style="height: 100%;width: 100%" id="graph_'+ index + i +'">图表数据</div>');

                        //console.log('select',$('.section:eq(' + index + ') li').eq(i).html());

                        var graph_chart = echarts.init(document.getElementById('graph_'+ index +i));//待补充

                        var option = getGraphOption(config_arr[i].graph_type,graph_vo);

                        graph_chart.setOption(option);

                    }else if(config_arr[i].block_type === 'chart') {
                        //控件
                        if(config_arr[i].graph_type === 'clock') {
                            //钟表
                            $('.seciton:eq(' + index + ') li').eq(i).append('<div>时钟数据</div>');

                            //$('').html(block_arr[i].time);//待完成
                        }else if (config_arr[i].graph_type === 'table') {
                            //表格
                            $('.seciton:eq(' + index + ') li').eq(i).append('<div id="table_'+ index + i +'">表格数据</div>');

                            //console.log('table',block_arr[i].html_contents);

                            $('#table_'+ index +i).append(block_arr[i].html_contents);// 待完成

                        }
                    }else {

                    }

                }
            }
            
            //添加弹出框
            $('button.addpage').on('click',function(){
                $('#page_name').val('');
                $('#page_name_field').removeClass('error');
                $('#page_modal').modal({
                    onApprove: function () {
                        if ($('#page_name').val()=='') {
                            $('#page_name_field').addClass('error');
                            return false;
                        } else {
                            //ajax,添加此页面绘制展示区，刷新展示页下拉框，注意判断重名
                            var send_data = {
                                groupName:$('#viewgroup_select').dropdown('get value'),
                                pageName:$('#page_name').val()
                            };
                            console.log('send_data_add',send_data);
                            $.ajax({
                                type: 'post',
                                url: '/carousel/add_page',
                                data: JSON.stringify(send_data),
                                dataType: 'json',
                                contentType:'application/json;charset=UTF-8',
                                success: function (result) {
                                    if(result.success) {
                                        var data=result.data;
                                        console.log('page_vo',data);
                                        page_vos.push(data);
                                        $('.gridster').html('');
                                        //gridster.remove_all_widgets();
                                        for(var i=0;i < page_vos.length;i++) {
                                            $('.gridster').append('<div class="section" ><ul></ul></div>');
                                            _gridster = $('.section:eq(' + i + ') ul').gridster({
                                                widget_selector: 'li',
                                                widget_margins: [50, 50],                       //margin大小
                                                widget_base_dimensions: [100, 100],             //网格粒度
                                                avoid_overlapped_widgets: true,  //不允许widgets加载的时候重叠
                                                max_cols: 15,                             //最多创建多少列，null表示没有限制
                                                max_rows: 10,                             //最多创建多少横，null表示没有限制
                                                min_cols: 1,                                //至少创建多少列
                                                min_rows: 1,                               //至少创建多少横
                                                resize: {
                                                    enabled: true,
                                                    max_size: [4, 4],
                                                    min_size: [1, 1]
                                                }
                                            }).data('gridster');
                                            drawPage(_gridster,page_vos[i],i);
                                        }
                                        getSelectPage($('#viewgroup_select').dropdown('get value'));
                                    }
                                    else {
                                        alert(result.message);
                                    }
                                },
                                error: function () {
                                    errorMsg_no_connect("添加展示页错误 Dropdown");
                                }
                            })
                        }
                    }
                }).modal('setting', 'closable', false).modal('show');
            });
            //修改弹出框
            $('button.writepage').on('click',function(){
                var old_page_name = $('#viewpage_select').dropdown('get value');
                $('#page_name').val(old_page_name);
                $('#page_name_field').removeClass('error');
                $('#page_modal').modal({
                    onApprove: function () {
                        if ($('#page_name').val()=='') {
                            $('#page_name_field').addClass('error');
                            return false;
                        } else {
                            //ajax,修改此页面绘制展示区，刷新展示页下拉框
                            var send_data = {
                                groupName:$('#viewgroup_select').dropdown('get value'),
                                newPageName:$('#page_name').val(),
                                oldPageName:old_page_name
                            };
                            $.ajax({
                                type: 'post',
                                url: '/carousel/update_page',
                                data:JSON.stringify(send_data),
                                dataType: 'json',
                                contentType:'application/json;charset=UTF-8',
                                success: function (result) {
                                    if(result.success) {
                                        var data=result.data;
                                        console.log('page_vo',data);
                                        for(var i=0;i<page_vos.length;i++) {
                                            if(page_vos[i].page_name === old_page_name) {
                                                page_vos.splice(i,1);
                                                page_vos.splice(i,0,data);
                                            }
                                        }
                                        console.log('new page_vos',page_vos);
                                        $('.gridster').html('');
                                        //gridster.remove_all_widgets();
                                        for(var i=0;i < page_vos.length;i++) {
                                            $('.gridster').append('<div class="section" ><ul></ul></div>');
                                            _gridster = $('.section:eq(' + i + ') ul').gridster({
                                                widget_selector: 'li',
                                                widget_margins: [50, 50],                       //margin大小
                                                widget_base_dimensions: [100, 100],             //网格粒度
                                                avoid_overlapped_widgets: true,  //不允许widgets加载的时候重叠
                                                max_cols: 15,                             //最多创建多少列，null表示没有限制
                                                max_rows: 10,                             //最多创建多少横，null表示没有限制
                                                min_cols: 1,                                //至少创建多少列
                                                min_rows: 1,                               //至少创建多少横
                                                resize: {
                                                    enabled: true,
                                                    max_size: [4, 4],
                                                    min_size: [1, 1]
                                                }
                                            }).data('gridster');
                                            drawPage(_gridster,page_vos[i],i);
                                        }
                                        getSelectPage($('#viewgroup_select').dropdown('get value'));
                                    }
                                    else {
                                        errorMsg_no_connect("修改展示页 Dropdown");
                                    }
                                },
                                error: function () {
                                    errorMsg_no_connect("修改展示页 Dropdown");
                                }
                            })
                        }
                    }
                }).modal('setting', 'closable', false).modal('show');
            });
            //删除弹出框
            $('button.deletepage').on('click',function(){
                var group_name = $('#viewgroup_select').dropdown('get text');
                var page_name = $('#viewpage_select').dropdown('get text');
                $('#delete_modal').modal({
                    onApprove: function () {
                        //ajax,根据page_name删除此页面绘制展示区，刷新展示页下拉框，注意添加删除的刷新效果
                        $.ajax({
                            type: 'get',
                            url: '/carousel/delete_page?group_name=' + group_name + '&page_name=' + page_name,
                            dataType: 'json',
                            success: function (result) {
                                if(result.success) {
                                    for(var i=0;i<page_vos.length;i++) {
                                        if(page_vos[i].page_name === page_name) {
                                            page_vos.splice(i,1);
                                        }
                                    }
                                    $('.gridster').html('');
                                    //gridster.remove_all_widgets();
                                    for(var i=0;i < page_vos.length;i++) {
                                        $('.gridster').append('<div class="section" ><ul></ul></div>');
                                        _gridster = $('.section:eq(' + i + ') ul').gridster({
                                            widget_selector: 'li',
                                            widget_margins: [50, 50],                       //margin大小
                                            widget_base_dimensions: [100, 100],             //网格粒度
                                            avoid_overlapped_widgets: true,  //不允许widgets加载的时候重叠
                                            max_cols: 15,                             //最多创建多少列，null表示没有限制
                                            max_rows: 10,                             //最多创建多少横，null表示没有限制
                                            min_cols: 1,                                //至少创建多少列
                                            min_rows: 1,                               //至少创建多少横
                                            resize: {
                                                enabled: true,
                                                max_size: [4, 4],
                                                min_size: [1, 1]
                                            }
                                        }).data('gridster');
                                        drawPage(_gridster,page_vos[i],i);
                                    }
                                    getSelectPage($('#viewgroup_select').dropdown('get value'));
                                }
                                else {
                                    errorMsg_no_data(result.message);
                                }
                            },
                            error: function () {
                                errorMsg_no_connect("展示页下拉框 Dropdown");
                            }
                        })

                    }
                }).modal('setting', 'closable', false).modal('show');
            });
            //编辑弹出框
            $("button.editpage").on("click",function(){
                $("button.addblock").show();
            });
            //刷新弹出框
            $("button.refreshpage").on("click",function(){
                alert("刷新成功！");
            });
            //保存页面弹出框
            $("button.savepage").on("click",function(){
                alert("保存成功！");
            });
//            //改变下拉框
//            $('#viewpage_select').dropdown({
//                onChange: function (value) {
//                    //$('#viewpage_select').addClass('loading disabled');
//                    var group_name=$("#viewgroup_select").dropdown("get text");
//                    var page_name=$("#viewpage_select").dropdown("get text");
//                    //根据group_name、page_name绘制展示区域，注意绘制完后取消刷新动画效果
//                }
//            })
            //添加块
            $("button.addblock").on("click",function(){
                $('#pointsMenu').html('');
                $('#itemsMenu').html('');
                $("#typeMenu").html('');
                //ajax，覆盖point_modal中的数据
                $('#point_modal').modal('setting', 'closable', false).modal('show');
                //ajax，覆盖视图类型中的数据
                $('#point_view_modal').modal('attach events', '#point_modal .view.button');
                //ajax，覆盖图表类型中的数据
                //获取设备选择树
                var hostIds = [];
                var $host_tree = $('#host_tree')
                genHostsTree($host_tree, hostIds, function () {
                    //选择设备后，执行的操作
                    $("#host_tree_button").on("click",function() {
                        hostIds = $host_tree.jstree(true).get_bottom_checked();
                        if (hostIds.length != 1) {
                            alert("所选设备不能为空或者不能多选");
                            return false;
                        } else {
                            //ajax,获取自定义选择监控点列表
                            pointsMenu(hostIds[0]);
                        }
                    })
                    $('#point_group_modal').modal({
                        onApprove: function () {
                            //判断所选非空
                        }
                    }).modal('attach events', '#point_modal .group.button');
                })

                //ajax，覆盖静态表格或时钟的数据
                $('#point_chart_modal').modal('attach events', '#point_modal .chart.button');
                $('#table_thead_modal').modal('attach events', '#point_chart_modal .button');
                $('#table_tbody_modal').modal('attach events', '#table_thead_modal .button');
                ////绘制每一个块的位置
                //gridster.remove_all_widgets();
//                $.each(serialization, function () {
//                    gridster.add_widget('<li />', this.size_x, this.size_y, this.col, this.row);
//                });
            });
            //加载监控点列表
            function pointsMenu(host_id) {
                $.ajax({
                    async: false,
                    type: "get",
                    url: "/hostgraphs/get_points?host_id="+host_id,
                    dataType: "json",
                    success: function (result) {
                        if(result.success) {
                            var data = result.data;
                            getpointsMenu(data);
                            itemsMenu(data[0].point_id);
                            $('#pointsMenu div').on('click',function () {
                                $('#pointsMenu div').removeClass('active');
                                $(this).addClass('active');
                                itemsMenu(this.id);
                            })
                        }
                        else {
                            errorMsg_no_data(result.message);
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("监控点列表 Menu");
                    }
                })
            }
            function getpointsMenu(data) {
                var str = '';
                for(var i=0;i<data.length;i++)
                {
                    var state = '<i class="green circle icon"></i>';
                    if (i==0){
                        str +="<div class='item textOverflow active' id='"+data[i].point_id+"' >"+state+"<div class='content'><div class='header'>"+data[i].point_name+"</div></div></div>";
                    }else {
                        str +="<div class='item textOverflow' id='"+data[i].point_id+"' >"+state+"<div class='content'><div class='header'>"+data[i].point_name+"</div></div></div>";
                    }
                }
                $("#pointsMenu").html(str);
            }
            //加载监控项列表
            function itemsMenu(point_id) {
                $.ajax({
                    type: "get",
                    url: "/hostgraphs/get_items?point_id="+point_id,
                    dataType: "json",
                    success: function (result) {
                        if(result.success) {
                            var data = result.data;
                            getitemsMenu(data);
                            typeMenu(data[0].value_type);
                            $('#itemsMenu div.item').on('click',function () {
                                $('#itemsMenu div.item').removeClass('active');
                                $(this).addClass('active');
                                typeMenu($(this).attr('data-type'));
                            })
                        }
                        else {
                            errorMsg_no_data(result.message);
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("监控项列表 Menu");
                    }
                })
            }
            function getitemsMenu(data) {
                var str = '';
                for(var i=0;i<data.length;i++)
                {
                    var state = '<i class="green square icon"></i>';
                    if (i==0){
                        str +="<div class='item textOverflow active' id='"+data[i].item_id+"' data-type='"+data[i].value_type+"'>"+state+"<div class='content'><div class='header'>"+data[i].item_name+"</div></div></div>";
                    }else {
                        str +="<div class='item textOverflow' id='"+data[i].item_id+"' data-type='"+data[i].value_type+"'>"+state+"<div class='content'><div class='header'>"+data[i].item_name+"</div></div></div>";
                    }
                }
                $("#itemsMenu").html(str);
            }
            //加载图形类型列表
            function typeMenu(value_type) {
                $.ajax({
                    type: "get",
                    url: "/hostgraphs/get_graphs?value_type="+value_type,
                    dataType: "json",
                    success: function (result) {
                        if(result.success) {
                            var data = result.data;
                            gettypeMenu(data);
                            $('#typeMenu div.item').on('click',function () {
                                $('#typeMenu div.item').removeClass('active');
                                $(this).addClass('active');
                            })
                        }
                        else {
                            errorMsg_no_data(result.message);
                        }
                    },
                    error: function () {
                        errorMsg_no_connect("图形类型列表 Menu");
                    }
                })
            }
            function gettypeMenu(data) {
                var str = '';
                for(var i=0;i<data.length;i++)
                {
                    var state = '<i class="green square icon"></i>';
                    if (i==0){
                        str +="<div class='item textOverflow active' data-type='"+data[i].graph_type+"'>"+state+"<div class='content'><div class='header'>"+data[i].graph_name+"</div></div></div>";
                    }else {
                        str +="<div class='item textOverflow' data-type='"+data[i].graph_type+"'>"+state+"<div class='content'><div class='header'>"+data[i].graph_name+"</div></div></div>";
                    }
                }
                $("#typeMenu").html(str);
            }
        </script>
    </th:block>
</th:block>

</body>
</html>