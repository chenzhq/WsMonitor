<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout::common_head(~{::title}, ~{::supplement})">
	<meta charset="UTF-8">
	<title>问题列表</title>
	<script src="../static/js/jquery-3.2.1.min.js"></script>
	<script src="../static/js/semantic.js"></script>
	<link rel="stylesheet" href="../static/css/semantic.css"  />
	<link rel="stylesheet" href="../static/css/icon.css"  />
	<link href="../static/css/ionicons.min.css" rel="stylesheet" />
	<link href="../static/css/main.css" rel="stylesheet" th:href="@{css/main.css}"/>
	<link href="../static/css/pace.css" rel="stylesheet" th:href="@{css/pace.css}"/>
	<th:block th:fragment="supplement">
		<link href="../static/css/lobibox.css" rel="stylesheet" th:href="@{css/lobibox.css}"/>
		<script src="http://rapapi.org/rap.plugin.js?projectId=19544&mode=3"></script>
		<style type="text/css">
			.ui.table.dataTable thead th {
				border-left: 0px;
			}
			.ui.special.popup.confirm{
				max-height: 260px;overflow-y:auto;overflow-x:hidden
			}
			.ui.special.popup.alarmed{
				max-height: 260px;overflow-y:auto;overflow-x:hidden
			}
			#table_modal_confirm{
				overflow-y:auto;
				overflow-x:hidden;
				max-height:160px;
				margin-bottom: 10px;
			}
			.ui.segment.detailconfirm{
				height: 232px;overflow-y:auto;overflow-x:hidden
			}
			.ui.segment.detailalarmed{
				height: 180px;overflow-y:auto;overflow-x:hidden
			}
		</style>
	</th:block>
</head>
<body>
<div id="contextWrap">
	<!--sidebar-->
	<div class="ui sidebar vertical left menu overlay  borderless visible sidemenu inverted  grey" data-color="grey"
		 th:replace="layout::left_menu">
		<a class="item logo" href="index.html">
			<img src="../static/images/logo.png" alt="stagblogo"/><img src="../static/images/thumblogo.png"
																	   alt="stagblogo" class="displaynone"/>
		</a>
		<div class="ui accordion inverted">
			<a class="title item" href="dashboard.html">
				<i class="ion-speedometer titleIcon icon"></i>仪表盘
			</a>
			<a class="title item" href="tab.html">
				<i class="ion-ios-lightbulb titleIcon icon"></i>监控视图
			</a>
			<a class="item active" href="overview.html">
				<i class="ion-ios-world titleIcon  icon"></i>业务概览
			</a>
			<div class="title item">
				<i class="ion-mouse titleIcon icon"></i>设备概览<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">服务器</a>
				<a class="item" href="#">网络设备</a>
				<a class="item" href="#">数据库</a>
				<a class="item" href="#">应用</a>
			</div>
			<a class="title item" href="#">
				<i class="ion-arrow-graph-up-right titleIcon icon"></i>视图展示
			</a>
			<div class="title item">
				<i class="ion-paintbrush titleIcon icon"></i>告警展示<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">告警日历</a>
				<a class="item" href="#">告警列表</a>
			</div>
			<a class="title item" href="#">
				<i class="ion-briefcase titleIcon icon"></i>报表统计
			</a>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>仪表盘1</span>
			<i class="ion-speedometer icon"></i>
			<div class="menu">
				<div class="header">
					仪表盘1
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>监控视图</span>
			<i class="ion-ios-lightbulb icon"></i>
			<div class="menu">
				<div class="header">
					监控视图
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>业务概览</span>
			<i class="ion-ios-world icon"></i>
			<div class="menu">
				<div class="header">
					业务概览
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>设备概览</span>
			<i class="ion-mouse icon"></i>
			<div class="menu">
				<div class="header">
					设备概览
				</div>
				<div class="ui divider"></div>
				<a class="item" href="tab.html">服务器</a>
				<a class="item" href="table.html">网络设备</a>
				<a class="item" href="error.html">数据库</a>
				<a class="item" href="login.html">应用</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>视图展示</span>
			<i class="ion-arrow-graph-up-right icon"></i>
			<div class="menu">
				<div class="header">
					视图展示
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>告警展示</span>
			<i class="ion-paintbrush icon"></i>
			<div class="menu">
				<div class="header">
					告警展示
				</div>
				<div class="ui divider"></div>
				<a class="item" href="error.html">告警日历</a>
				<a class="item" href="error.html">告警列表</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>报表统计</span>
			<a href="error.html">
				<i class="ion-briefcase icon"></i>
			</a>
		</div>

		<div class="ui divider"></div>

	</div>

	<!--sidebar-->

	<div class="pusher">
		<!--navbar-->
		<div class="navslide navwrap" th:replace="layout::top_nav">
			<div class="ui menu icon borderless grid" data-color="inverted white">
				<a class="item labeled openbtn">
					<i class="ion-navicon-round big icon"></i>
				</a>
				<div class="item ui colhidden">
					<div class="ui icon input">
						<input type="text" placeholder="Search...">
						<i class="search icon"></i>
					</div>
				</div>
				<div class="right menu colhidden">
					<div class="ui dropdown item labeled icon">
						<i class="bell icon"></i> 告警
						<div class="ui red label mini circular">6</div>
						<div class="menu">
							<div class="header">
								紧急告警
							</div>
							<div class="item">
								告警信息1……
								<div class="ui teal left pointing label">1</div>
							</div>
							<div class="item">
								告警信息2……
								<div class="ui label">51</div>
							</div>
							<div class="item">
								告警信息3……
								<div class="ui label">1</div>
							</div>
							<div class="header">
								严重告警
							</div>
							<div class="item">
								<i class="dropdown icon"></i>
								<span class="text">更多</span>
								<div class="menu">
									<div class="item">告警信息……</div>
									<div class="item">告警信息……</div>
								</div>
							</div>
						</div>
					</div>
					<div class="ui dropdown item">
						<img class="ui mini circular image" src="../static/images/0.jpg" th:src="@{images/0.jpg}"
							 alt="label-image"/>
						<div class="menu">
							<a class="item" href="mail.html">注销</a>
						</div>
					</div>
					<a class="item labeled rightsidebar computer only">
						<i class="ion-wrench large icon"></i>工具
					</a>
				</div>
			</div>
		</div>
		<!--navbar-->
		<!--maincontent-->
		<div class="mainWrap navslide">
			<div class="ui equal width left aligned padded grid stackable">
				<!--Site Content-->
				<div class="sixteen wide tablet sixteen wide computer column">
					<div class="ui segments">
						<div class="ui segment">
							<div class="ui grid">
								<div class="row">
									<div class="eight wide column">
										<h3><i class="bar large chart icon"></i>问题列表</h3>
									</div>
									<div class="eight wide column">
										<div class="ui basic top attached right floated buttons"  id="problemsMenu">
											<button value="currentProblems" class="ui active button">当前问题</button>
											<button value="recentProblems" class="ui button">最近问题</button>
											<button value="historicalRecord" class="ui button">历史记录</button>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="ui segment"  style=" min-height : 500px;">
							<div class="sixteen wide column">
									<table  id="problemsTable" class="ui compact basic table center aligned ">
									</table>
							</div>
						</div>
					</div>
				</div>
				<!--已告警提示框 start-->
				<div class="ui special popup alarmed">
					<div class="sixteen wide column">
						<table class="ui very basic compact collapsing celled fixed single line table center aligned">
							<thead>
							<tr>
								<th class="four wide">步骤</th>
								<th class="four wide">时间</th>
								<th class="four wide">状态（重试次数）</th>
								<th class="four wide">接收者</th>
							</tr></thead>
							<tbody id="alarmedTable">
							<tr>
								<td colspan="4">无数据</td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
				<!--已告警提示框 end-->
				<!--确认记录提示框 start-->
				<div class="ui special popup confirm">
					<table class="ui very basic compact collapsing celled fixed single line table center aligned">
						<thead>
						<tr>
							<th class="four wide">时间</th>
							<th class="four wide">用户</th>
							<th class="four wide">消息</th>
							<th class="four wide">用户动作</th>
						</tr></thead>
						<tbody id="confirmTable">
						<tr>
							<td colspan="4">无数据</td>
						</tr>
						</tbody>
					</table>
				</div>
				<!--确认记录提示框 end-->
				<!--确认记录模态框 start-->
				<div class="ui small modal confirm">
					<div class="content">
						<div class="ui form">
							<div class="required inline field" id="text_field">
								<input type="text" id="confirmmodal_text" placeholder="不能为空">
							</div>
							<div id="table_modal_confirm">
								<table class="ui celled striped compact single line table center aligned">
									<thead>
									<tr>
										<th class="four wide">时间</th>
										<th class="four wide">用户</th>
										<th class="four wide">消息</th>
										<th class="four wide">用户动作</th>
									</tr></thead>
									<tbody id="confirmTable_modal">
									<tr>
										<td colspan="4">无数据</td>
									</tr>
									</tbody>
								</table>
							</div>
							<div class="required inline field" id="text_checkbox">
								<div class="ui checkbox">
									<input type="checkbox" tabindex="0" class="hidden">
									<label  id="label_checkbox">关闭问题</label>
								</div>
							</div>
						</div>
					</div>
					<div class="actions">
						<div class="ui approve submit button">确认</div>
						<div class="ui cancel button">取消</div>
					</div>
				</div>
				<!--确认记录模态框 end-->
				<!--事件详情模态框 start-->
				<div class="ui big modal detail">
					<div class="content">
						<div class="sixteen wide column">
							<div class="ui grid">
								<div class="eight wide column">
									<div class="ui segments">
										<div class="ui segment">
											<h4 class="ui header">
												事件细节
											</h4>
										</div>
										<div class="ui segment no-padding detailconfirm">
											<table class="ui very basic compact fixed definition table center aligned">
												<tbody id="detailTable_tab">
												<tr>
													<td colspan="2">无数据</td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
								<div class="eight wide column">
									<div class="ui segments">
										<div class="ui segment">
											<h4 class="ui header">
												确认记录
											</h4>
										</div>
										<div class="ui segment detailconfirm">
											<table class="ui very basic compact fixed single line table center aligned">
												<thead>
												<tr>
													<th class="four wide">时间</th>
													<th class="four wide">用户</th>
													<th class="four wide">消息</th>
													<th class="four wide">用户动作</th>
												</tr></thead>
												<tbody id="confirmTable_tab">
												<tr>
													<td colspan="4">无历史确认记录</td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
								<div class="sixteen wide column">
									<div class="ui segments">
										<div class="ui segment">
											<h4 class="ui header">
												告警记录
											</h4>
										</div>
										<div class="ui segment detailalarmed">
											<table class="ui very basic compact fixed single line table center aligned">
												<thead>
												<tr>
													<th class="one wide">步骤</th>
													<th class="three wide">时间</th>
													<th class="two wide">接收者</th>
													<th class="one wide">方式</th>
													<th class="four wide">主题</th>
													<th class="four wide">信息</th>
													<th class="one wide" title="状态(重试次数)">状态(重试次数)</th>
												</tr></thead>
												<tbody id="alarmedTable_tab">
												<tr>
													<td colspan="7">无历史确认记录</td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--事件详情模态框 end-->
			</div>
		</div>
	</div>
</div>

<div id="del-pop" class="ui custom popup transition hidden">
	<div class="description">是否删除该分组？</div>
	<i class="mini checkmark negative icon "></i>
</div>
<th:block th:replace="layout::bottom_script(~{::specialScript})">
	<script src="../static/js/js.cookie.js"></script>
	<script src="../static/js/jquery.nicescroll.min.js"></script>
	<script data-pace-options='{ "ajax": false }' src="../static/js/pace.js"></script>
	<script src="../static/js/main.js"></script>
	<th:block th:fragment="specialScript">
		<script src="../static/js/jquery.dataTables.js" th:src="@{js/jquery.dataTables.js}"></script>
		<script src="../static/js/custom-datatable.js" th:src="@{js/custom-datatable.js}"></script>
		<script src="../static/js/assistantTool.js" th:src="@{js/assistantTool.js}"></script>
		<script src="../static/js/notifications.js" th:src="@{js/notifications.js}"></script>
	</th:block>
</th:block>
<script type="text/javascript">
    //页面加载完加载基础数据
    $(function() {
        //初始化选项页
        $('.secondary.pointing.menu .item')
            .tab();
        //下拉框事件
        $("#ui_dropdown").change(function(){
            var tmp=$("#ui_dropdown").val()
            host_table.search(tmp).draw();
        });
    })
</script>
<script type="text/javascript">
    $(document).ready(function() {
        //初始当前问题列表
        var problems_Table = $("#problemsTable").DataTable({
            "iDisplayLength" : 10,
            order: [0, 'desc'],
            "createdRow": function (row, data, dataIndex) {
                $('td', row).eq(1).addClass('left aligned');
                $('td', row).eq(2).addClass('left aligned');
            },
            "drawCallback": function () {//初始化后回调
                //点击事件详情事件
                $('#problemsTable a.detail').on('click',function(){
                    var event_id=$(this).attr("data-id");
                    //初始化事件详情模态框
                    detailmodal(event_id);
                    detailconfirm(event_id);
                    detailrecord(event_id);
                    $('.ui.modal.detail').modal('show');
                })
                //点击确认记录事件
                $('#problemsTable a.confirm').on('click',function(){
                    var event_id=$(this).attr("data-id");
                    confirmmodal(event_id);
                    $('.ui.modal.confirm').modal({
                        onApprove: function () {
                            //验证是否为空
                            if($("#confirmmodal_text").val()=="")
                            {
                                $("#text_field").addClass("error");
                                return false;
                            }else if(!$('.ui.checkbox').checkbox("is checked"))
                            {
                                $("#text_checkbox").addClass("error");
                                return false;
                            }else {
                                alert("完成一次关闭问题的确认操作，接口详情有问题，待完成")
							}
                        }
                    }).modal('setting', 'closable', false).modal('show');
                })
                //浮动确认记录事件
                $('#problemsTable a.confirm').hover(function() {
                    var event_id=$(this).attr("data-id");
                    confirmpopup(event_id);
                }).popup({
                    popup: '.special.popup.confirm',
                    inline: true,
                    hoverable  : true,
                    delay: {
                        show: 800,
                        hide: 300
                    }
                });
                //浮动已告警事件
                $('#problemsTable a.alarmed').hover(function() {
                    var event_id=$(this).attr("data-id");
                    alarmedpopup(event_id);
                }).popup({
                    popup: '.special.popup.alarmed',
                    inline: true,
                    hoverable  : true,
                    delay: {
                        show: 800,
                        hide: 300
                    }
                });
            },
            ajax: {
                url: '/problemlist/get_allproblems',
                dataSrc: 'data'
            },
            columns: [
                {
                    "data": "problem_time",
                    "width": "15%",
                    "title": "发生时间",
                    "orderable": false,
                },
                {
                    "data": "host_name",
                    "width": "10%",
                    "title": "设备",
                    "orderable": false,
                },
                {
                    "data": null,
                    "width": "25%",
                    "title": "问题",
                    "orderable": false,
                    render: function(data, type, row, meta) {
                        return '<a href="problemdetail?trigger_id=' + row.trigger_id + '">' + row.description + '</a>';
                    }
                },
                {
                    "data": "priority_state",
                    "width": "5%",
                    "title": "严重性",
                    "orderable": false,
                       //priority_state<td style="color: red">严重</td>
                },
                {
                    "data": null,
                    "width": "5%",
                    "title": "状态",
                    "orderable": false,
                    render: function(data, type, row, meta) {
                        if(row.problem_state != "问题"){
                            return row.problem_state;
						}
                        else {
                            return '<a href="javascript:void(0)" data-id="'+row.problem_eventid+'" class="alarmed">' + row.problem_state + '</a>';
						}
                    }
				},
                {
                    "data": "recover_time",
                    "width": "10%",
                    "title": "恢复时间",
                    "orderable": false,
                },
                {
                    "data": "duration_string",
                    "width": "10%",
                    "title": "持续时间",
                    "orderable": false,
                },
                {
                    "data": null,
                    "width": "15%",
                    "title": "告警状态",
                    "orderable": false,
                    render: function(data, type, row, meta) {
                        return row.alert_state + '(' + row.alert_num + ')';
                    }
                },
                {
                    "data": null,
                    "width": "5%",
                    "title": "确认",
                    "orderable": false,
                    render: function(data, type, row, meta) {
						if(row.acknowledged == "是"){
							return row.acknowledged;
						}
						else {
							return '<a href="javascript:void(0)" data-id="'+row.problem_eventid+'" class="confirm">' + row.acknowledged + '</a>';
						}
                    }
                },
                {
                    "data": null,
                    "width": "5%",
                    "title": "操作",
                    "orderable": false,
                    render: function(data, type, row, meta) {
						return '<a href="javascript:void(0)" data-id="'+row.problem_eventid+'" class="detail">详情</a>';
                    }
                }
            ],
        });
        //点击问题列表菜单
        $('#problemsMenu button').on('click',function () {
            $('#problemsMenu button').removeClass('active');
            $(this).addClass('active');
            if(this.value == "currentProblems"){
                problems_Table.ajax.url('/problemlist/get_allproblems').load();
			}else if(this.value == "recentProblems"){
                problems_Table.ajax.url('/problemlist/get_lastproblems').load();
			}else if(this.value == "historicalRecord"){
			    var begin_time='2017-1-29';
                var end_time='2017-8-29';
                problems_Table.ajax.url('/problemlist/get_historyproblems?begin_time='+begin_time+'&end_time='+end_time).load();
            }
        })
    })
    //连接确认记录提示框
    function confirmpopup(event_id) {
        $.ajax({
            type: "get",
            url: "/problemlist/get_acknowledges?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    getconfirmpopup(data)
                } else {
                    errorMsg_no_data("确认记录 Popup");
                }
            },
            error: function () {
                errorMsg_no_connect("确认记录 Popup");
            }
        })
    }
    //获取确认记录提示框内容
    function getconfirmpopup(data) {
        var str = '';
        for(var i=0;i<data.length;i++)
        {
            if(data[i].action == '0'){
                var action = '未确认';
            }
            else if(data[i].action == '1'){
                var action = '已确认';
            }
			str += "<tr><td>"
				+data[i].clock+"</td><td>"
				+data[i].alias+"</td><td class='left aligned'>"
				+data[i].message+"</td><td>"
				+action+"</td></tr>"
        }
        $("#confirmTable").html(str);
    }
    //连接已告警提示框
    function alarmedpopup(event_id) {
        $.ajax({
            type: "get",
            url: "/problemlist/get_alerts?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    getalarmedpopup(data)
                } else {
                    errorMsg_no_data("已告警 Popup");
                }
            },
            error: function () {
                errorMsg_no_connect("已告警 Popup");
            }
        })
    }
    //获取已告警提示框
    function getalarmedpopup(data){
        var str = '';
        for(var i=0;i<data.length;i++)
        {
            str += "<tr><td>"
                +data[i].esc_step+"</td><td>"
                +data[i].last_time+"</td><td>"
                +data[i].status+"("+data[i].retries+")</td><td>"
                +data[i].sendto+"</td></tr>"
        }
        $("#alarmedTable").html(str);
	}

    //连接事件详情模态框，细节列表
    function detailmodal(event_id) {
        $.ajax({
            type: "get",
            url: "/eventdetail/get_detail?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    //初始化细节列表
                    getdetailmodal(data);
                } else {
                    errorMsg_no_data("细节列表 modal");
                }
            },
            error: function () {
                errorMsg_no_connect("细节列表 modal");
            }
        })
    }
    //获取事件详情模态框，细节列表
    function getdetailmodal(data){
        var str = '';
		if(data.closed == true){
			var closed = '已关闭';
		}
		else if(data.closed == false){
			var closed = '未关闭';
		}
		str += "<tr><td>所属主机</td><td>"
			+data.host_name+"</td></tr><tr><td>监控点</td><td>"
			+data.point_name+"</td></tr><tr><td>监控项</td><td>"
			+data.item_name+"</td></tr><tr><td>阀值</td><td>"
			+data.threshold+"</td></tr><tr><td>触发器描述</td><td  title='"+data.trigger_name+"'>"
			+data.trigger_name+"</td></tr><tr><td>发生时间</td><td>"
			+data.problem_time+"</td></tr><tr><td>恢复时间</td><td>"
			+data.recovery_time+"</td></tr><tr><td>手动关闭(操作人)</td><td>"
			+closed+"("+data.closed_user+")</td></tr>"
        $("#detailTable_tab").html(str);
    }
    //连接事件详情模态框，确认列表
    function detailconfirm(event_id) {
        $.ajax({
            type: "get",
            url: "/problemlist/get_acknowledges?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    //初始化细节列表
                    getdetailconfirm(data);
                } else {
                    errorMsg_no_data("确认列表 modal");
                }
            },
            error: function () {
                errorMsg_no_connect("确认列表 modal");
            }
        })
    }
    //获取事件详情模态框，确认列表
    function getdetailconfirm(data){
        var str = '';
        for(var i=0;i<data.length;i++)
        {
            if(data[i].action == '0'){
                var action = '未确认';
            }
            else if(data[i].action == '1'){
                var action = '已确认';
            }
            str += "<tr><td>"
                +data[i].clock+"</td><td>"
                +data[i].alias+"</td><td class='left aligned'>"
                +data[i].message+"</td><td>"
                +action+"</td></tr>"
        }
        $("#confirmTable_tab").html(str);
    }
    //连接事件详情模态框，记录列表
    function detailrecord(event_id) {
        $.ajax({
            type: "get",
            url: "/alertdetail/get_detail?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    //初始化细节列表
                    getdetailrecord(data);
                } else {
                    errorMsg_no_data("记录列表 modal");
                }
            },
            error: function () {
                errorMsg_no_connect("记录列表 modal");
            }
        })
    }
    //获取事件详情模态框，记录列表
    function getdetailrecord(data){
        var str = '';
        for(var i=0;i<data.length;i++)
        {
            str += "<tr><td>"
                +data[i].esc_step+"</td><td>"
                +data[i].last_time+"</td><td>"
                +data[i].sendto+"</td><td>"
                +data[i].alert_type+"</td><td class='left aligned' title='"+data[i].subject+"'>"
                +data[i].subject+"</td><td class='left aligned' title='"+data[i].message+"'>"
                +data[i].message+"</td><td>"
                +data[i].status+"("+data[i].retries+")</td></tr>"
        }
        $("#alarmedTable_tab").html(str);
    }
    //连接确认记录模态框，历史确认记录
    function confirmmodal(event_id) {
        $("#confirmmodal_text").val("");
		$("#text_field").removeClass("error");
        $("#text_checkbox").removeClass("error");
        $('.ui.checkbox').checkbox("set unchecked");
        //用户是否可以关闭问题
        $.ajax({
            type: "get",
            url: "/acknowledge/is_closed?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    if (data.checkbox_enable==false){
                        $('.ui.checkbox').addClass("disabled");
                        $("#label_checkbox").html(data.disable_message)
                    }else {
                        $("#label_checkbox").html("问题可关闭")
					}
                } else {
                    errorMsg_no_data("用户是否可关闭问题 modal");
                }
            },
            error: function () {
                errorMsg_no_connect("用户是否可关闭问题 modal");
            }
        })
		//历史确认记录
        $.ajax({
            type: "get",
            url: "/problemlist/get_acknowledges?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    getconfirmmodal(data);
                } else {
                    errorMsg_no_data("历史确认记录 modal");
                }
            },
            error: function () {
                errorMsg_no_connect("历史确认记录 modal");
            }
        })
    }
    //获取确认记录模态框，历史确认记录
    function getconfirmmodal(data){
        var str = '';
        for(var i=0;i<data.length;i++)
        {
            if(data[i].action == '0'){
                var action = '未确认';
            }
            else if(data[i].action == '1'){
                var action = '已确认';
            }
            str += "<tr><td>"
                +data[i].clock+"</td><td>"
                +data[i].alias+"</td><td class='left aligned'>"
                +data[i].message+"</td><td>"
                +action+"</td></tr>"
        }
        $("#confirmTable_modal").html(str);
    }

</script>
</body>
</html>



