<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout::common_head(~{::title}, ~{::supplement})">
	<meta charset="UTF-8">
	<title>问题列表</title>
	<script src="../static/js/jquery-3.2.1.min.js"></script>
	<script src="../static/js/semantic.js"></script>
	<link rel="stylesheet" href="../static/css/semantic.css"  />
	<link rel="stylesheet" href="../static/css/icon.css"  />
	<link href="../static/css/ionicons.min.css" rel="stylesheet" />
	<link href="../static/css/main.css" rel="stylesheet" th:href="@{css/main.css}"/>
	<link href="../static/css/pace.css" rel="stylesheet" th:href="@{css/pace.css}"/>
	<th:block th:fragment="supplement">
		<link href="../static/css/lobibox.css" rel="stylesheet" th:href="@{css/lobibox.css}"/>
		<script src="http://rapapi.org/rap.plugin.js?projectId=19544&mode=0"></script>
		<style type="text/css">
			.ui.table.dataTable thead th {
				border-left: 0px;
			}
			.ui.special.popup.confirm{
				height: 260px;width: 500px;overflow:auto;overflow-x:hidden
			}
			.ui.special.popup.alarmed{
				height: 260px;width: 500px;overflow:auto;overflow-x:hidden
			}
		</style>
	</th:block>
</head>
<body>
<div id="contextWrap">
	<!--sidebar-->
	<div class="ui sidebar vertical left menu overlay  borderless visible sidemenu inverted  grey" data-color="grey"
		 th:replace="layout::left_menu">
		<a class="item logo" href="index.html">
			<img src="../static/images/logo.png" alt="stagblogo"/><img src="../static/images/thumblogo.png"
																	   alt="stagblogo" class="displaynone"/>
		</a>
		<div class="ui accordion inverted">
			<a class="title item" href="dashboard.html">
				<i class="ion-speedometer titleIcon icon"></i>仪表盘
			</a>
			<a class="title item" href="tab.html">
				<i class="ion-ios-lightbulb titleIcon icon"></i>监控视图
			</a>
			<a class="item active" href="overview.html">
				<i class="ion-ios-world titleIcon  icon"></i>业务概览
			</a>
			<div class="title item">
				<i class="ion-mouse titleIcon icon"></i>设备概览<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">服务器</a>
				<a class="item" href="#">网络设备</a>
				<a class="item" href="#">数据库</a>
				<a class="item" href="#">应用</a>
			</div>
			<a class="title item" href="#">
				<i class="ion-arrow-graph-up-right titleIcon icon"></i>视图展示
			</a>
			<div class="title item">
				<i class="ion-paintbrush titleIcon icon"></i>告警展示<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">告警日历</a>
				<a class="item" href="#">告警列表</a>
			</div>
			<a class="title item" href="#">
				<i class="ion-briefcase titleIcon icon"></i>报表统计
			</a>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>仪表盘1</span>
			<i class="ion-speedometer icon"></i>
			<div class="menu">
				<div class="header">
					仪表盘1
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>监控视图</span>
			<i class="ion-ios-lightbulb icon"></i>
			<div class="menu">
				<div class="header">
					监控视图
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>业务概览</span>
			<i class="ion-ios-world icon"></i>
			<div class="menu">
				<div class="header">
					业务概览
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>设备概览</span>
			<i class="ion-mouse icon"></i>
			<div class="menu">
				<div class="header">
					设备概览
				</div>
				<div class="ui divider"></div>
				<a class="item" href="tab.html">服务器</a>
				<a class="item" href="table.html">网络设备</a>
				<a class="item" href="error.html">数据库</a>
				<a class="item" href="login.html">应用</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>视图展示</span>
			<i class="ion-arrow-graph-up-right icon"></i>
			<div class="menu">
				<div class="header">
					视图展示
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>告警展示</span>
			<i class="ion-paintbrush icon"></i>
			<div class="menu">
				<div class="header">
					告警展示
				</div>
				<div class="ui divider"></div>
				<a class="item" href="error.html">告警日历</a>
				<a class="item" href="error.html">告警列表</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>报表统计</span>
			<a href="error.html">
				<i class="ion-briefcase icon"></i>
			</a>
		</div>

		<div class="ui divider"></div>

	</div>

	<!--sidebar-->

	<div class="pusher">
		<!--navbar-->
		<div class="navslide navwrap" th:replace="layout::top_nav">
			<div class="ui menu icon borderless grid" data-color="inverted white">
				<a class="item labeled openbtn">
					<i class="ion-navicon-round big icon"></i>
				</a>
				<div class="item ui colhidden">
					<div class="ui icon input">
						<input type="text" placeholder="Search...">
						<i class="search icon"></i>
					</div>
				</div>
				<div class="right menu colhidden">
					<div class="ui dropdown item labeled icon">
						<i class="bell icon"></i> 告警
						<div class="ui red label mini circular">6</div>
						<div class="menu">
							<div class="header">
								紧急告警
							</div>
							<div class="item">
								告警信息1……
								<div class="ui teal left pointing label">1</div>
							</div>
							<div class="item">
								告警信息2……
								<div class="ui label">51</div>
							</div>
							<div class="item">
								告警信息3……
								<div class="ui label">1</div>
							</div>
							<div class="header">
								严重告警
							</div>
							<div class="item">
								<i class="dropdown icon"></i>
								<span class="text">更多</span>
								<div class="menu">
									<div class="item">告警信息……</div>
									<div class="item">告警信息……</div>
								</div>
							</div>
						</div>
					</div>
					<div class="ui dropdown item">
						<img class="ui mini circular image" src="../static/images/0.jpg" th:src="@{images/0.jpg}"
							 alt="label-image"/>
						<div class="menu">
							<a class="item" href="mail.html">注销</a>
						</div>
					</div>
					<a class="item labeled rightsidebar computer only">
						<i class="ion-wrench large icon"></i>工具
					</a>
				</div>
			</div>
		</div>
		<!--navbar-->
		<!--maincontent-->
		<div class="mainWrap navslide">
			<div class="ui equal width left aligned padded grid stackable">
				<!--Site Content-->
				<div class="sixteen wide tablet sixteen wide computer column">
					<div class="ui segments">
						<div class="ui segment no-padding">
							<div class="ui secondary menu">
								<a class="header item">
									<h3><i class="bar large chart icon"></i>问题列表</h3>
								</a>
								<a class="right item">
									告警状态：
                                    <select id="ui_dropdown" class="ui dropdown">
                                        <option value="">选择告警状态</option>
                                        <option>未告警</option>
                                        <option>告警失败</option>
                                        <option>已告警</option>
                                    </select>
								</a>
							</div>
						</div>
						<div class="ui segment"  style=" min-height : 500px;">
							<div class="ui pointing secondary menu" id="problemsMenu">
								<a class="active item" id="currentProblems" >当前问题</a>
								<a class="item" id="recentProblems">最近问题</a>
								<a class="item" id="historicalRecord">历史记录</a>
							</div>

							<div class="ui segment noBorder">
								<div class="sixteen wide column">
									<table  id="problemsTable" class="ui compact very basic table center aligned ">
										<!--静态数据 start-->
										<thead>
										<tr>
											<th class="two wide">发生时间</th>
											<th class="two wide">设备</th>
											<th class="three wide">问题</th>
											<th class="one wide">严重性</th>
											<th class="one wide">状态</th>
											<th class="two wide">恢复时间</th>
											<th class="one wide">持续时间</th>
											<th class="two wide">告警状态</th>
											<th class="one wide">确认</th>
											<th class="one wide">操作</th>
										</tr></thead>
										<tbody>
										<tr>
											<td>2017-8-22 15:10:03</td>
											<td>设备2</td>
											<td><a href="problemdetail.html">主机1内存使用率超过90%</a></td>
											<td style="color: red">严重</td>
											<td><a href="javascript:void(0)" class="alarmed">已解决</a></td>
											<td>2017-8-25 15:18:22</td>
											<td>2秒</td>
											<td>成功，告警数1</td>
											<td><a href="javascript:void(0)" class="confirm">是</a></td>
											<td><a href="javascript:void(0)" class="detail">事件详情</a></td>
										</tr>
										<tr>
											<td><a href="javascript:void(0)" class="modal">2017-8-22 15:10:03</a></td>
											<td>设备2</td>
											<td><a href="problemdetail.html">主机1内存使用率超过90%</a></td>
											<td style="color: yellow">告警</td>
											<td>问题</td>
											<td></td>
											<td>82秒</td>
											<td>发送中，告警数5</td>
											<td>否</td>
											<td><a href="javascript:void(0)" class="detail">事件详情</a></td>
										</tr>
										<tr>
											<td>2017-8-22 15:10:03</td>
											<td>设备2</td>
											<td><a href="problemdetail.html">主机1内存使用率超过90%</a></td>
											<td style="color: green">一般</td>
											<td><a href="javascript:void(0)" class="alarmed">已解决</a></td>
											<td>2017-8-25 15:18:22</td>
											<td>2秒</td>
											<td>失败，告警数0</td>
											<td><a href="javascript:void(0)" class="confirm">是</a></td>
											<td><a href="javascript:void(0)" class="detail">事件详情</a></td>
										</tr>
										<tr>
											<td>2017-8-22 15:10:03</td>
											<td>设备2</td>
											<td><a href="problemdetail.html">主机1内存使用率超过90%</a></td>
											<td style="color: red">严重</td>
											<td>问题</td>
											<td>2017-8-25 15:18:22</td>
											<td>2秒</td>
											<td>发送中,告警数2</td>
											<td><a href="javascript:void(0)" class="confirm">否</a></td>
											<td><a href="javascript:void(0)" class="detail">事件详情</a></td>
										</tr>
										</tbody>
										<!--静态数据 end-->
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--已告警提示框 start-->
				<div class="ui special popup alarmed">
					<table class="ui very basic compact collapsing celled fixed single line table">
						<thead>
						<tr>
							<th class="four wide">步骤</th>
							<th class="four wide">时间</th>
							<th class="four wide">状态（重试次数）</th>
							<th class="four wide">接收者</th>
						</tr></thead>
						<tbody id="alarmedTable">
						<!--静态数据 start-->
						<tr>
							<td>1</td>
							<td>2017-08-12 11:13:39</td>
							<td>已发送通知(0)</td>
							<td>chen[chenzhq.2@gmail.com]</td>
						</tr>
						<tr>
							<td>2</td>
							<td>2017-08-12 11:13:39</td>
							<td>已发送通知(1)</td>
							<td>admin[admin@gmail.com]</td>
						</tr>
						<tr>
							<td>1</td>
							<td>2017-08-12 11:13:39</td>
							<td>已发送通知(0)</td>
							<td>admin[admin@gmail.com]</td>
						</tr>
						<!--静态数据 end-->
						</tbody>
					</table>
				</div>
				<!--已告警提示框 end-->
				<!--确认记录提示框 start-->
				<div class="ui special popup confirm">
					<table class="ui very basic compact collapsing celled fixed single line table">
						<thead>
						<tr>
							<th class="four wide">时间</th>
							<th class="four wide">用户</th>
							<th class="four wide">消息</th>
							<th class="four wide">用户动作</th>
						</tr></thead>
						<tbody id="confirmTable">
						<!--静态数据 start-->
						<tr>
							<td>2017-8-22 15:10:03</td>
							<td>yans(12312@qq.com)</td>
							<td>主机1内存使用率超过90%</td>
							<td>已关闭</td>
						</tr>
						<tr>
							<td>2017-8-22 15:10:03</td>
							<td>yans(12312@qq.com)</td>
							<td>主机1内存使用率超过90%</td>
							<td>未关闭</td>
						</tr>
						<tr>
							<td>2017-8-22 15:10:03</td>
							<td>yans(12312@qq.com)</td>
							<td>主机1内存使用率超过90%</td>
							<td></td>
						</tr>
						<!--静态数据 end-->
						</tbody>
					</table>
				</div>
				<!--确认记录提示框 end-->
				<!--确认记录模态框 start-->
				<div class="ui small modal confirm">
					<div class="header">标题</div>
					<div class="content">
						<div class="ui form">
							<div class="required inline field">
								<label>名</label>
								<input type="text" placeholder="Full Name">
							</div>
							<p>有历史确认记录，则在文本框下方列出，与确认记录数据一致</p>
							<div class="required inline field">
								<div class="ui checkbox">
									<input type="checkbox" tabindex="0" class="hidden">
									<label>关闭问题</label>
								</div>
							</div>
						</div>
					</div>
					<div class="actions">
						<div class="ui approve submit button">确认</div>
						<div class="ui cancel button">取消</div>
					</div>
				</div>
				<!--确认记录模态框 end-->
				<!--事件详情模态框 start-->
				<div class="ui small modal detail">
					<div class="content">
						<div class="ui  pointing secondary menu">
							<a class="active item" data-tab="detailDetails">事件细节</a>
							<a class="item" data-tab="detailConfirm">确认</a>
							<a class="item" data-tab="detailRecord">告警记录</a>
						</div>
						<div class="ui bottom attached active tab segment" data-tab="detailDetails">
							<p>[所属主机，监控点名称，监控项名称]考虑合并在一起显示，阀值，（触发器）描述，发生时间，恢复时间，手动关闭[Admin/无]</p>
						</div>
						<div class="ui bottom attached tab segment" data-tab="detailConfirm">
							<table class="ui very basic compact collapsing celled fixed single line table">
								<!--静态数据 start-->
								<thead>
								<tr>
									<th class="four wide">时间</th>
									<th class="four wide">用户</th>
									<th class="four wide">消息</th>
									<th class="four wide">用户动作</th>
								</tr></thead>
								<tbody id="confirmTable_tab">
								<tr>
									<td>2017-8-22 15:10:03</td>
									<td>yans(12312@qq.com)</td>
									<td>主机1内存使用率超过90%</td>
									<td>已关闭</td>
								</tr>
								<tr>
									<td>2017-8-22 15:10:03</td>
									<td>yans(12312@qq.com)</td>
									<td>主机1内存使用率超过90%</td>
									<td>未关闭</td>
								</tr>
								<tr>
									<td>2017-8-22 15:10:03</td>
									<td>yans(12312@qq.com)</td>
									<td>主机1内存使用率超过90%</td>
									<td></td>
								</tr>
								</tbody>
								<!--静态数据 end-->
							</table>
						</div>
						<div class="ui bottom attached tab segment" data-tab="detailRecord">
							<table class="ui very basic compact collapsing celled fixed single line table">
								<!--静态数据 start-->
								<thead>
								<tr>
									<th class="four wide">步骤</th>
									<th class="four wide">时间</th>
									<th class="four wide">接收者</th>
									<th class="four wide">告警方式</th>
									<th class="four wide">主题</th>
									<th class="four wide">信息</th>
									<th class="four wide">状态（重试次数）</th>
								</tr></thead>
								<tbody id="alarmedTable_tab">
								<tr>
									<td>1</td>
									<td>2017-08-12 11:13:39</td>
									<td>告警方式</td>
									<td>主题</td>
									<td>信息</td>
									<td>chen[chenzhq.2@gmail.com]</td>
									<td>已发送通知(0)</td>
								</tr>
								<tr>
									<td>2</td>
									<td>2017-08-12 11:13:39</td>
									<td>告警方式</td>
									<td>主题</td>
									<td>信息</td>
									<td>admin[admin@gmail.com]</td>
									<td>已发送通知(1)</td>
								</tr>
								<tr>
									<td>1</td>
									<td>2017-08-12 11:13:39</td>
									<td>告警方式</td>
									<td>主题</td>
									<td>信息</td>
									<td>admin[admin@gmail.com]</td>
									<td>已发送通知(0)</td>
								</tr>
								</tbody>
								<!--静态数据 end-->
							</table>
						</div>
					</div>
					<div class="actions">
						<div class="ui approve submit button">确认</div>
						<div class="ui cancel button">取消</div>
					</div>
				</div>
				<!--事件详情模态框 end-->
			</div>
		</div>
	</div>
</div>

<div id="del-pop" class="ui custom popup transition hidden">
	<div class="description">是否删除该分组？</div>
	<i class="mini checkmark negative icon "></i>
</div>
<th:block th:replace="layout::bottom_script(~{::specialScript})">
	<script src="../static/js/js.cookie.js"></script>
	<script src="../static/js/jquery.nicescroll.min.js"></script>
	<script data-pace-options='{ "ajax": false }' src="../static/js/pace.js"></script>
	<script src="../static/js/main.js"></script>
	<th:block th:fragment="specialScript">
		<script src="../static/js/jquery.dataTables.js" th:src="@{js/jquery.dataTables.js}"></script>
		<script src="../static/js/custom-datatable.js" th:src="@{js/custom-datatable.js}"></script>
		<script src="../static/js/assistantTool.js" th:src="@{js/assistantTool.js}"></script>
		<script src="../static/js/notifications.js" th:src="@{js/notifications.js}"></script>
	</th:block>
</th:block>
<script type="text/javascript">
    //页面加载完加载基础数据
    $(function() {
        //初始折叠菜单
        $('.ui.checkbox').checkbox();
        //初始化选项页
        $('.secondary.pointing.menu .item')
            .tab();
        //下拉框事件
        $("#ui_dropdown").change(function(){
            var tmp=$("#ui_dropdown").val()
            host_table.search(tmp).draw();
        });
    })
</script>
<script type="text/javascript">
    $(document).ready(function() {
        //初始当前问题列表
        var problems_Table = $("#problemsTable").DataTable({
            "iDisplayLength" : 10,
            order: [0, 'desc'],
            "createdRow": function (row, data, dataIndex) {
                $('td', row).eq(1).addClass('left aligned');
                $('td', row).eq(2).addClass('left aligned');
            },
            "drawCallback": function () {//初始化后回调
                //点击事件详情事件
                $('#problemsTable a.detail').on('click',function(){
                    var event_id=$(this).attr("data-id");
                    detailmodal(event_id);
                    $('.ui.modal.detail').modal('setting', 'closable', false).modal('show');
                })
                //点击确认记录事件
                $('#problemsTable a.confirm').on('click',function(){
                    $('.ui.modal.confirm').modal('setting', 'closable', false).modal('show');
                })
                //浮动确认记录事件
                $('#problemsTable a.confirm').hover(function() {
                    var event_id=$(this).attr("data-id");
                    confirmpopup(event_id);
                }).popup({
                    popup: '.special.popup.confirm',
                    inline: true,
                    hoverable  : true,
                    delay: {
                        show: 800,
                        hide: 300
                    }
                });
                //浮动已告警事件
                $('#problemsTable a.alarmed').hover(function() {
                    var event_id=$(this).attr("data-id");
                    alarmedpopup(event_id);
                }).popup({
                    popup: '.special.popup.alarmed',
                    inline: true,
                    hoverable  : true,
                    delay: {
                        show: 800,
                        hide: 300
                    }
                });
            },
            ajax: {
                url: '/problemlist/get_allproblems',
                dataSrc: 'data'
            },
            columns: [
                {
                    "data": "problem_time",
                    "width": "15%",
                    "title": "发生时间",
                    "orderable": false,
                },
                {
                    "data": "host_name",
                    "width": "10%",
                    "title": "设备",
                    "orderable": false,
                },
                {
                    "data": null,
                    "width": "25%",
                    "title": "问题",
                    "orderable": false,
                    render: function(data, type, row, meta) {
                        return '<a href="problemdetail?trigger_id=' + row.trigger_id + '">' + row.description + '</a>';
                    }
                },
                {
                    "data": "priority_state",
                    "width": "5%",
                    "title": "严重性",
                    "orderable": false,
                       //priority_state<td style="color: red">严重</td>
                },
                {
                    "data": null,
                    "width": "5%",
                    "title": "状态",
                    "orderable": false,
                    render: function(data, type, row, meta) {
                        if(row.problem_state != "问题"){
                            return row.problem_state;
						}
                        else {
                            return '<a href="javascript:void(0)" data-id="'+row.problem_eventid+'" class="alarmed">' + row.problem_state + '</a>';
						}
                    }
				},
                {
                    "data": "recover_time",
                    "width": "10%",
                    "title": "恢复时间",
                    "orderable": false,
                },
                {
                    "data": "duration_string",
                    "width": "10%",
                    "title": "持续时间",
                    "orderable": false,
                },
                {
                    "data": null,
                    "width": "15%",
                    "title": "[告警状态]",
                    "orderable": false,
                    render: function(data, type, row, meta) {
                        return row.alert_state + '，告警数' + row.alert_num;
                    }
                },
                {
                    "data": null,
                    "width": "5%",
                    "title": "确认",
                    "orderable": false,
                    render: function(data, type, row, meta) {
						if(row.acknowledged == "是"){
							return row.acknowledged;
						}
						else {
							return '<a href="javascript:void(0)" data-id="'+row.problem_eventid+'" class="confirm">' + row.acknowledged + '</a>';
						}
                    }
                },
                {
                    "data": null,
                    "width": "5%",
                    "title": "操作",
                    "orderable": false,
                    render: function(data, type, row, meta) {
						return '<a href="javascript:void(0)" data-id="'+row.problem_eventid+'" class="detail">详情</a>';
                    }
                }
            ],
        });
        //点击问题列表菜单
        $('#problemsMenu a').on('click',function () {
            $('#problemsMenu a').removeClass('active');
            $(this).addClass('active');
            if(this.id == "currentProblems"){
                problems_Table.ajax.url('/problemlist/get_allproblems').load();
			}else if(this.id == "recentProblems"){
                problems_Table.ajax.url('/problemlist/get_lastproblems').load();
			}else if(this.id == "historicalRecord"){
			    var begin_time='2017-1-29';
                var end_time='2017-8-29';
                problems_Table.ajax.url('/problemlist/get_historyproblems?begin_time='+begin_time+'&end_time='+end_time).load();
            }
        })
    })
    //连接确认记录提示框
    function confirmpopup(event_id) {
        $.ajax({
            type: "get",
            url: "/problemlist/get_acknowledges?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    getconfirmpopup(data)
                } else {
                    errorMsg_no_data("确认记录 Popup");
                }
            },
            error: function () {
                errorMsg_no_connect("确认记录 Popup");
            }
        })
    }
    //获取确认记录提示框内容
    function getconfirmpopup(data) {
        var str = '';
        for(var i=0;i<data.length;i++)
        {
            if(data[i].action == '0'){
                var action = '未确认';
            }
            else if(data[i].action == '1'){
                var action = '已确认';
            }
			str += "<tr id='"+data[i].acknowledge_id+"'><td>"
				+data[i].clock+"</td><td>"
				+data[i].alias+"</td><td>"
				+data[i].message+"</td><td>"
				+action+"</td></tr>"
        }
        $("#confirmTable").html(str);
    }
    //连接已告警提示框
    function alarmedpopup(event_id) {
        $.ajax({
            type: "get",
            url: "/problemlist/get_alerts?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    getalarmedpopup(data)
                } else {
                    errorMsg_no_data("已告警 Popup");
                }
            },
            error: function () {
                errorMsg_no_connect("已告警 Popup");
            }
        })
    }
    //获取已告警提示框
    function getalarmedpopup(data){
        var str = '';
        for(var i=0;i<data.length;i++)
        {
            str += "<tr id='"+data[i].alert_id+"'><td>"
                +data[i].esc_step+"</td><td>"
                +data[i].last_time+"</td><td>"
                +data[i].status+")"+data[i].retries+")</td><td>"
                +data[i].sendto+"</td></tr>"
        }
        $("#alarmedTable").html(str);
	}
    //初始化事件详情模态框
    $('.secondary.pointing.menu .item')
        .tab({
            'onVisible': function (path) {
                if (path === 'detailConfirm') {
                    //初始化确认列表
                    detailconfirm();
                }
                if (path === 'detailRecord') {
                    //初始化记录列表
                    detailrecord();
                }
            }
        });
    //连接事件详情模态框，细节列表
    function detailmodal(event_id) {
        $.ajax({
            type: "get",
            url: "/problemlist/get_alerts?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    //初始化细节列表
                    getdetailmodal(data);
                } else {
                    errorMsg_no_data("细节列表 modal");
                }
            },
            error: function () {
                errorMsg_no_connect("细节列表 modal");
            }
        })
    }
    //获取事件详情模态框，细节列表
    function getdetailmodal(data){
        //待完成
    }
    //连接事件详情模态框，确认列表
    function detailconfirm(event_id) {
        $.ajax({
            type: "get",
            url: "/problemlist/get_acknowledges?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    //初始化细节列表
                    getdetailconfirm(data);
                } else {
                    errorMsg_no_data("确认列表 modal");
                }
            },
            error: function () {
                errorMsg_no_connect("确认列表 modal");
            }
        })
    }
    //获取事件详情模态框，确认列表
    function getdetailconfirm(data){
        var str = '';
        for(var i=0;i<data.length;i++)
        {
            if(data[i].action == '0'){
                var action = '未确认';
            }
            else if(data[i].action == '1'){
                var action = '已确认';
            }
            str += "<tr id='"+data[i].acknowledge_id+"'><td>"
                +data[i].clock+"</td><td>"
                +data[i].alias+"</td><td>"
                +data[i].message+"</td><td>"
                +action+"</td></tr>"
        }
        $("#confirmTable_tab").html(str);
    }
    //连接事件详情模态框，记录列表
    function detailrecord(event_id) {
        $.ajax({
            type: "get",
            url: "/problemlist/get_alerts?event_id=" + event_id,
            dataType: "json",
            success: function (result) {
                if (result.success) {
                    var data = result.data;
                    //初始化细节列表
                    getdetailrecord(data);
                } else {
                    errorMsg_no_data("记录列表 modal");
                }
            },
            error: function () {
                errorMsg_no_connect("记录列表 modal");
            }
        })
    }
    //获取事件详情模态框，记录列表
    function getdetailrecord(data){
        //待完成
    }
</script>
</body>
</html>



