<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout::common_head(~{::title}, ~{::supplement})">
	<meta charset="UTF-8">
	<title>问题列表</title>
	<script src="../static/js/jquery-3.2.1.min.js"></script>
	<script src="../static/js/semantic.js"></script>
	<link rel="stylesheet" href="../static/css/semantic.css"  />
	<link rel="stylesheet" href="../static/css/icon.css"  />
	<link href="../static/css/ionicons.min.css" rel="stylesheet" />
	<link href="../static/css/main.css" rel="stylesheet" th:href="@{css/main.css}"/>
	<link href="../static/css/pace.css" rel="stylesheet" th:href="@{css/pace.css}"/>
	<th:block th:fragment="supplement">
		<link href="../static/css/lobibox.css" rel="stylesheet" th:href="@{css/lobibox.css}"/>
		<script src="http://rapapi.org/rap.plugin.js?projectId=19544&mode=0"></script>
		<style type="text/css">
			.ui.table.dataTable thead th {
				border-left: 0px;
			}
			.ui.special.popup.confirm{
				height: 260px;width: 500px;overflow:auto;overflow-x:hidden
			}
			.ui.special.popup.alarmed{
				height: 260px;width: 500px;overflow:auto;overflow-x:hidden
			}
		</style>
	</th:block>
</head>
<body>
<div id="contextWrap">
	<!--sidebar-->
	<div class="ui sidebar vertical left menu overlay  borderless visible sidemenu inverted  grey" data-color="grey"
		 th:replace="layout::left_menu">
		<a class="item logo" href="index.html">
			<img src="../static/images/logo.png" alt="stagblogo"/><img src="../static/images/thumblogo.png"
																	   alt="stagblogo" class="displaynone"/>
		</a>
		<div class="ui accordion inverted">
			<a class="title item" href="dashboard.html">
				<i class="ion-speedometer titleIcon icon"></i>仪表盘
			</a>
			<a class="title item" href="tab.html">
				<i class="ion-ios-lightbulb titleIcon icon"></i>监控视图
			</a>
			<a class="item active" href="overview.html">
				<i class="ion-ios-world titleIcon  icon"></i>业务概览
			</a>
			<div class="title item">
				<i class="ion-mouse titleIcon icon"></i>设备概览<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">服务器</a>
				<a class="item" href="#">网络设备</a>
				<a class="item" href="#">数据库</a>
				<a class="item" href="#">应用</a>
			</div>
			<a class="title item" href="#">
				<i class="ion-arrow-graph-up-right titleIcon icon"></i>视图展示
			</a>
			<div class="title item">
				<i class="ion-paintbrush titleIcon icon"></i>告警展示<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">告警日历</a>
				<a class="item" href="#">告警列表</a>
			</div>
			<a class="title item" href="#">
				<i class="ion-briefcase titleIcon icon"></i>报表统计
			</a>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>仪表盘1</span>
			<i class="ion-speedometer icon"></i>
			<div class="menu">
				<div class="header">
					仪表盘1
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>监控视图</span>
			<i class="ion-ios-lightbulb icon"></i>
			<div class="menu">
				<div class="header">
					监控视图
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>业务概览</span>
			<i class="ion-ios-world icon"></i>
			<div class="menu">
				<div class="header">
					业务概览
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>设备概览</span>
			<i class="ion-mouse icon"></i>
			<div class="menu">
				<div class="header">
					设备概览
				</div>
				<div class="ui divider"></div>
				<a class="item" href="tab.html">服务器</a>
				<a class="item" href="table.html">网络设备</a>
				<a class="item" href="error.html">数据库</a>
				<a class="item" href="login.html">应用</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>视图展示</span>
			<i class="ion-arrow-graph-up-right icon"></i>
			<div class="menu">
				<div class="header">
					视图展示
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>告警展示</span>
			<i class="ion-paintbrush icon"></i>
			<div class="menu">
				<div class="header">
					告警展示
				</div>
				<div class="ui divider"></div>
				<a class="item" href="error.html">告警日历</a>
				<a class="item" href="error.html">告警列表</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>报表统计</span>
			<a href="error.html">
				<i class="ion-briefcase icon"></i>
			</a>
		</div>

		<div class="ui divider"></div>

	</div>

	<!--sidebar-->

	<div class="pusher">
		<!--navbar-->
		<div class="navslide navwrap" th:replace="layout::top_nav">
			<div class="ui menu icon borderless grid" data-color="inverted white">
				<a class="item labeled openbtn">
					<i class="ion-navicon-round big icon"></i>
				</a>
				<div class="item ui colhidden">
					<div class="ui icon input">
						<input type="text" placeholder="Search...">
						<i class="search icon"></i>
					</div>
				</div>
				<div class="right menu colhidden">
					<div class="ui dropdown item labeled icon">
						<i class="bell icon"></i> 告警
						<div class="ui red label mini circular">6</div>
						<div class="menu">
							<div class="header">
								紧急告警
							</div>
							<div class="item">
								告警信息1……
								<div class="ui teal left pointing label">1</div>
							</div>
							<div class="item">
								告警信息2……
								<div class="ui label">51</div>
							</div>
							<div class="item">
								告警信息3……
								<div class="ui label">1</div>
							</div>
							<div class="header">
								严重告警
							</div>
							<div class="item">
								<i class="dropdown icon"></i>
								<span class="text">更多</span>
								<div class="menu">
									<div class="item">告警信息……</div>
									<div class="item">告警信息……</div>
								</div>
							</div>
						</div>
					</div>
					<div class="ui dropdown item">
						<img class="ui mini circular image" src="../static/images/0.jpg" th:src="@{images/0.jpg}"
							 alt="label-image"/>
						<div class="menu">
							<a class="item" href="mail.html">注销</a>
						</div>
					</div>
					<a class="item labeled rightsidebar computer only">
						<i class="ion-wrench large icon"></i>工具
					</a>
				</div>
			</div>
		</div>
		<!--navbar-->
		<!--maincontent-->
		<div class="mainWrap navslide">
			<div class="ui equal width left aligned padded grid stackable">
				<!--Site Content-->
				<div class="sixteen wide tablet sixteen wide computer column">
					<div class="ui segments">
						<div class="ui segment no-padding">
							<div class="ui secondary menu">
								<a class="header item">
									<h3><i class="bar large chart icon"></i>问题列表</h3>
								</a>
								<a class="right item">
									告警状态：
                                    <select id="ui_dropdown" class="ui dropdown">
                                        <option value="">选择告警状态</option>
                                        <option>未告警</option>
                                        <option>告警失败</option>
                                        <option>已告警</option>
                                    </select>
								</a>
							</div>
						</div>
						<div class="ui segment"  style=" min-height : 500px;">
							<div id="host_table_dimmer" class="ui inverted dimmer">
								<div class="ui text loader">加载</div>
							</div>
							<table  id="host_table" class="ui compact very basic table center aligned ">
								<!--静态数据 start-->
								<thead>
								<tr>
									<th class="two wide">发生时间</th>
									<th class="two wide">设备</th>
									<th class="four wide">问题</th>
									<th class="two wide">严重性</th>
									<th class="two wide">持续时间</th>
									<th class="two wide">[告警状态]</th>
									<th class="one wide">确认</th>
									<th class="one wide">详情</th>
								</tr></thead>
								<tbody>
								<tr>
									<td>2017-8-22 15:10:03</td>
									<td>设备1</td>
									<td>主机1内存使用率超过90%</td>
									<td style="color: yellow">告警</td>
									<td>2秒</td>
									<td>未告警</td>
									<td>不</td>
									<td><a href="javascript:void(0)">详情</a></td>
								</tr>
								<tr>
									<td>2017-8-22 15:10:03</td>
									<td>设备2</td>
									<td>主机1内存使用率超过90%</td>
									<td style="color: red">严重</td>
									<td>2秒</td>
									<td>告警失败</td>
									<td><a href="javascript:void(0)" class="confirm">是</a></td>
									<td><a href="javascript:void(0)">详情</a></td>
								</tr>
								<tr>
									<td>2017-8-22 15:10:03</td>
									<td>设备3</td>
									<td>主机1内存使用率超过90%</td>
									<td style="color: red">严重</td>
									<td>2秒</td>
									<td><a href="javascript:void(0)" class="alarmed" id="已告警pop_id">已告警</a></td>
									<td><a href="javascript:void(0)" class="confirm"  id="是pop_id">是</a></td>
									<td><a href="javascript:void(0)">详情</a></td>
								</tr>
								</tbody>
								<!--静态数据 end-->
							</table>
						</div>
					</div>
				</div>
				<!--已告警提示框 start-->
				<div class="ui special popup alarmed">
					<table id="alarmedTable" class="ui very basic compact collapsing celled fixed single line table">
						<!--静态数据 start-->
						<thead>
						<tr>
							<th class="four wide">步骤</th>
							<th class="four wide">时间</th>
							<th class="four wide">状态（重试次数）</th>
							<th class="four wide">接收者</th>
						</tr></thead>
						<tbody>
						<tr>
							<td>1</td>
							<td>2017-08-12 11:13:39</td>
							<td>已发送通知(0)</td>
							<td>chen[chenzhq.2@gmail.com]</td>
						</tr>
						<tr>
							<td>2</td>
							<td>2017-08-12 11:13:39</td>
							<td>已发送通知(1)</td>
							<td>admin[admin@gmail.com]</td>
						</tr>
						<tr>
							<td>1</td>
							<td>2017-08-12 11:13:39</td>
							<td>已发送通知(0)</td>
							<td>admin[admin@gmail.com]</td>
						</tr>
						</tbody>
						<!--静态数据 end-->
					</table>
				</div>
				<!--已告警提示框 end-->
				<!--确认记录提示框 start-->
				<div class="ui special popup confirm">
					<table id="confirmTable" class="ui very basic compact collapsing celled fixed single line table">
						<!--静态数据 start-->
						<thead>
						<tr>
							<th class="four wide">时间</th>
							<th class="four wide">用户</th>
							<th class="four wide">消息</th>
							<th class="four wide">用户动作</th>
						</tr></thead>
						<tbody>
						<tr>
							<td>2017-8-22 15:10:03</td>
							<td>yans(12312@qq.com)</td>
							<td>主机1内存使用率超过90%</td>
							<td>已关闭</td>
						</tr>
						<tr>
							<td>2017-8-22 15:10:03</td>
							<td>yans(12312@qq.com)</td>
							<td>主机1内存使用率超过90%</td>
							<td>未关闭</td>
						</tr>
						<tr>
							<td>2017-8-22 15:10:03</td>
							<td>yans(12312@qq.com)</td>
							<td>主机1内存使用率超过90%</td>
							<td></td>
						</tr>
						</tbody>
						<!--静态数据 end-->
					</table>
				</div>
				<!--确认记录提示框 end-->
			</div>
		</div>
	</div>
</div>
<!--modal-->
<div id="del-pop" class="ui custom popup transition hidden">
	<div class="description">是否删除该分组？</div>
	<i class="mini checkmark negative icon "></i>
</div>
<th:block th:replace="layout::bottom_script(~{::specialScript})">
	<script src="../static/js/js.cookie.js"></script>
	<script src="../static/js/jquery.nicescroll.min.js"></script>
	<script data-pace-options='{ "ajax": false }' src="../static/js/pace.js"></script>
	<script src="../static/js/main.js"></script>
	<th:block th:fragment="specialScript">
		<script src="../static/js/jquery.dataTables.js" th:src="@{js/jquery.dataTables.js}"></script>
		<script src="../static/js/custom-datatable.js" th:src="@{js/custom-datatable.js}"></script>
		<script src="../static/js/assistantTool.js" th:src="@{js/assistantTool.js}"></script>
		<script src="../static/js/notifications.js" th:src="@{js/notifications.js}"></script>
	</th:block>
</th:block>
<script type="text/javascript">
	//下拉框事件
	$("#ui_dropdown").change(function(){
		var tmp=$("#ui_dropdown").val()
		host_table.search(tmp).draw();
	});

	//点击已告警事件
	$('#host_table a.alarmed').hover(function(e) {
		//alarmedpopup();
	}).popup({
		popup: '.special.popup.alarmed',
		inline: true,
		hoverable  : true,
		delay: {
			show: 800,
			hide: 300
		}
	});
   //连接已告警提示框
   function alarmedpopup() {
       var point_id = this.id.substring(1);
       $.ajax({
           type: "get",
           url: "/brief/point?point_id=" + point_id,
           dataType: "json",
           success: function (result) {
               if (result.success) {
                   var data = result.data;
                   getalarmedpopup(data)
               } else {
                   errorMsg_no_data("已告警 Popup");
               }
           },
           error: function () {
               errorMsg_no_connect("已告警 Popup");
           }
       })
   }
   //获取已告警提示框内容
   function getalarmedpopup(data) {
   }
	//点击确认记录事件
	$('#host_table a.confirm').hover(function(e) {
        //confirmpopup();
	}).popup({
		popup: '.special.popup.confirm',
		inline: true,
		hoverable  : true,
		delay: {
			show: 800,
			hide: 300
		}
	});
   //连接确认记录提示框
   function confirmpopup() {
       var point_id = this.id.substring(1);
       $.ajax({
           type: "get",
           url: "/brief/point?point_id=" + point_id,
           dataType: "json",
           success: function (result) {
               if (result.success) {
                   var data = result.data;
                   getconfirmpopup(data)
               } else {
                   errorMsg_no_data("确认记录 Popup");
               }
           },
           error: function () {
               errorMsg_no_connect("确认记录 Popup");
           }
       })
   }
   //获取确认记录提示框内容
   function getconfirmpopup(data) {
	   var Color = ['red', 'yellow', 'green'];
	   var item_datas = data.item_datas;
	   var str_item_datas = '';
	   var myColor = '';
	   for (var i = 0; i < item_datas.length; i++) {
		   if (item_datas[i].with_triggers == true) {
			   if (item_datas[i].state == "严重") {
				   myColor = Color[0]
			   }
			   if (item_datas[i].state == "警告") {
				   myColor = Color[1]
			   }
			   if (item_datas[i].state == "正常") {
				   myColor = Color[2]
			   }
		   } else {
			   myColor = ''
		   }
		   if (strlen(item_datas[i].item_name) > 16) {
			   var item_name = "<td title=" + item_datas[i].item_name + "><span>" + item_datas[i].item_name + "</span></td>"
		   } else {
			   var item_name = "<td><span>" + item_datas[i].item_name + "</span></td>"
		   }
		   if (strlen(item_datas[i].value) > 16) {
			   var item_value = "<td title=" + item_datas[i].value + "><span class='ui " + myColor + " header textOverflow'>" + item_datas[i].value + "</span></td>"
		   } else {
			   var item_value = "<td><span class='ui " + myColor + " header textOverflow'>" + item_datas[i].value + "</span></td>"
		   }
		   str_item_datas += "<tr>" + item_name + item_value + "</tr>";
	   }

	   if (data.state == "正常") {
		   myColor = Color[2]
	   }
	   if (data.state == "严重") {
		   myColor = Color[0]
	   }
	   if (data.state == "警告") {
		   myColor = Color[1]
	   }
	   $("#point_name").html("名称：" + data.point_name);
	   $("#point_state").html("状态：&nbsp&nbsp<div class='ui mini " + myColor + " horizontal label' style='margin-bottom: 0'>" + data.state + "</div>");
	   $("#item_datas").html(str_item_datas);
   }
</script>
<script>
	/* $(document).ready(function() {
	 var host_table = $("#host_table").DataTable({
	 "paging": false,
	 "ordering": false,
	 "createdRow": function (row, data, dataIndex) {
	 //$(row).addClass(tmp)
	 $('td', row).eq(0).addClass('left aligned');
	 $('td', row).eq(2).addClass('no-padding');
	 },
	 ajax: {
	 url: '/host/overview',
	 dataSrc: 'data'
	 },
	 columns: [
	 {
	 "data": "type",
	 "width": "15%",
	 "title": "发生时间",
	 },
	 {
	 "data": "type",
	 "width": "15%",
	 "title": "设备",
	 },
	 {
	 "data": "type",
	 "width": "30%",
	 "title": "问题",
	 },
	 {
	 "data": "null",
	 "width": "10%",
	 "title": "严重性",
	 render: function(data, type, row, meta) {

	 }
	 },
	 {
	 "data": "type",
	 "width": "10%",
	 "title": "持续时间",
	 },
	 {
	 "data": "type",
	 "width": "10%",
	 "title": "[告警状态]",
	 },
	 {
	 "data": "type",
	 "width": "10%",
	 "title": "确认",
	 },
	 {
	 "data": null,
	 "width": "20%",
	 "title": "名称",
	 render: function(data, type, row, meta) {
	 if (data.state == "正常") {
	 if (row.type === '组') {
	 return '<i class="green folder icon"></i>' + row.name;
	 } else if(row.type === '监控点') {
	 return '<i class="green circle icon"></i>' + row.name;
	 } else {
	 return '<a href="hostDetail?host_id=' + row.cid.substr(1) +'" style="color: rgba(0, 0, 0, 0.87);">' +
	 '<i class="green desktop icon"></i>' + row.name + '</a>';
	 }
	 } else if (data.state == "严重") {
	 if (row.type === '组') {
	 return '<i class="red folder icon"></i>' + row.name;
	 } else if(row.type === '监控点') {
	 return '<i class="red circle icon"></i>' + row.name;
	 } else {
	 return '<a href="hostDetail?host_id=' + row.cid.substr(1) +'" style="color: rgba(0, 0, 0, 0.87);">' +
	 '<i class="red desktop icon"></i>' + row.name + '</a>';
	 }

	 } else if (data.state == "警告") {
	 if (row.type === '组') {
	 return '<i class="yellow folder icon"></i>' + row.name;
	 } else if(row.type === '监控点') {
	 return '<i class="yellow circle icon"></i>' + row.name;
	 } else {
	 return '<a href="hostDetail?host_id=' + row.cid.substr(1) +'" style="color: rgba(0, 0, 0, 0.87);">' +
	 '<i class="yellow desktop icon"></i>' + row.name + '</a>';
	 }

	 } else {
	 return '<i class="list green layout icon"></i>' + row.name;
	 }
	 }

	 },
	 {
	 "data": "type",
	 "width": "20%",
	 "title": "类型",
	 },
	 {
	 "data": null,
	 "width": "20%",
	 "title": "操作",
	 render: function(data, type, row, meta) {
	 if(row.type=="组"){
	 if(row.cid === 'g0') {
	 return '<div class="ui secondary menu">' +
	 '<a class="right item new" id="'+row.cid+'"> 新建</a></div>';
	 }
	 return '<div class="ui secondary menu">' +
	 '<a class="right item new" > 新建</a>' +
	 '<a class="item move" > 移动</a>' +
	 '<a class="item edit" > 编辑</a>' +
	 '<a class="item delete"> 删除</a></div>';
	 }else {
	 return '<div class="ui secondary menu"><a class="right item move" id="'+row.pid+'_'+row.cid+'"> 移动</a><a class="item edit" id="'+row.cid+'"> 编辑</a></div>';
	 }
	 }
	 },
	 ],
	 });
	 */
</script>
</body>
</html>



