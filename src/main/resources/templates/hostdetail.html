<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head  th:replace="layout::common_head(~{::title}, ~{::supplement})">
	<meta charset="UTF-8">
	<title >监控系统</title>
	<script src="../static/js/jquery-3.2.1.min.js" th:src="@{js/jquery-3.2.1.min.js}"></script>
	<script src="../static/js/semantic.js" th:src="@{js/semantic.js}"></script>
	<link rel="stylesheet" href="../static/css/semantic.css" th:href="@{/css/semantic.css}"/>
	<link rel="stylesheet" href="../static/css/icon.css" th:href="@{css/icon.css}"/>
	<link href="../static/css/ionicons.min.css" rel="stylesheet" th:href="@{css/ionicons.min.css}"/>
	<link href="../static/css/main.css" rel="stylesheet" th:href="@{css/main.css}"/>
	<link href="../static/css/pace.css" rel="stylesheet" th:href="@{css/pace.css}"/>
	<link href="../static/css/lobibox.css" rel="stylesheet" th:href="@{css/lobibox.css}"/>
	<th:block th:fragment="supplement">
		<link href="../static/css/jquery.gridly.css" rel="stylesheet" th:href="@{css/jquery.gridly.css}"/>
		<script src="../static/js/jquery.gridly.js" th:src="@{js/jquery.gridly.js}"></script>
		<script src="../static/js/echarts.min.js" th:src="@{js/echarts.min.js}"></script>
		<script src="../static/js/notifications.js" th:src="@{js/notifications.js}"></script>
		<script src="http://rapapi.org/rap.plugin.js?projectId=19544&mode=0"></script>
		<style type="text/css">
			.no-padding-bottom{  padding-bottom: 0px;  }
			.chart-style{  height: 200px  }
			.gridly {
				position: relative;
				width: 100%;
			}
			.brick.small {
				height: 200px;
				width: 25%;
			}
		</style>
	</th:block>

</head>
<body>
<!--header start-->
<div id="contextWrap">
	<!--sidebar-->
	<div class="ui sidebar vertical left menu overlay  borderless visible sidemenu inverted  grey" data-color="grey"
		 th:replace="layout::left_menu">
		<a class="item logo" href="index.html">
			<img src="../static/images/logo.png" alt="stagblogo"/><img src="../static/images/thumblogo.png"
																	   alt="stagblogo" class="displaynone"/>
		</a>
		<div class="ui accordion inverted">
			<a class="title item" href="#">
                <i class="ion-speedometer titleIcon icon"></i>仪表盘
			</a>
			<a class="title item" href="#">
				<i class="ion-ios-lightbulb titleIcon icon"></i>监控视图
			</a>
			<a class="item" href="#">
				<i class="ion-ios-world titleIcon  icon"></i>业务概览
			</a>
			<div class="title item">
				<i class="ion-mouse titleIcon icon"></i>设备监控<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">设备总览</a>
				<a class="item" href="#">网络设备</a>
				<a class="item" href="#">数据库</a>
				<a class="item" href="#">应用</a>
			</div>
			<a class="title item" href="#">
				<i class="ion-arrow-graph-up-right titleIcon icon"></i>视图展示
			</a>
			<div class="title item">
				<i class="ion-paintbrush titleIcon icon"></i>告警展示<i class="dropdown icon"></i>
			</div>
			<div class="content">
				<a class="item" href="#">告警日历</a>
				<a class="item" href="#">告警列表</a>
			</div>
			<a class="title item" href="#">
				<i class="ion-briefcase titleIcon icon"></i>报表统计
			</a>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>仪表盘1</span>
			<i class="ion-speedometer icon"></i>
			<div class="menu">
				<div class="header">
					仪表盘1
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>监控视图</span>
			<i class="ion-ios-lightbulb icon"></i>
			<div class="menu">
				<div class="header">
					监控视图
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>业务概览</span>
			<i class="ion-ios-world icon"></i>
			<div class="menu">
				<div class="header">
					业务概览
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>设备概览</span>
			<i class="ion-mouse icon"></i>
			<div class="menu">
				<div class="header">
					设备概览
				</div>
				<div class="ui divider"></div>
				<a class="item" href="tab.html">服务器</a>
				<a class="item" href="table.html">网络设备</a>
				<a class="item" href="error.html">数据库</a>
				<a class="item" href="login.html">应用</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>视图展示</span>
			<i class="ion-arrow-graph-up-right icon"></i>
			<div class="menu">
				<div class="header">
					视图展示
				</div>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>告警展示</span>
			<i class="ion-paintbrush icon"></i>
			<div class="menu">
				<div class="header">
					告警展示
				</div>
				<div class="ui divider"></div>
				<a class="item" href="error.html">告警日历</a>
				<a class="item" href="error.html">告警列表</a>
			</div>
		</div>

		<div class="ui dropdown item displaynone scrolling">
			<span>报表统计</span>
			<a href="error.html">
				<i class="ion-briefcase icon"></i>
			</a>
		</div>

		<div class="ui divider"></div>

	</div>

	<!--sidebar-->

	<div class="pusher">
		<!--navbar-->
		<div class="navslide navwrap" th:fragment="top_nav">
			<div class="ui menu icon borderless grid" data-color="inverted white">
				<a class="item labeled openbtn">
					<i class="ion-navicon-round big icon"></i>
				</a>
				<div class="item ui colhidden">
					<div class="ui icon input">
						<input type="text" placeholder="Search...">
						<i class="search icon"></i>
					</div>
				</div>
				<div class="right menu colhidden">
					<div class="ui dropdown item labeled icon">
						<i class="bell icon"></i>   告警
						<div class="ui red label mini circular">6</div>
						<div class="menu" >
							<div class="header">
								紧急告警
							</div>
							<div class="item">
								告警信息1……
								<div class="ui teal left pointing label">1</div>
							</div>
							<div class="item">
								告警信息2……
								<div class="ui label">51</div>
							</div>
							<div class="item">
								告警信息3……
								<div class="ui label">1</div>
							</div>
							<div class="header">
								严重告警
							</div>
							<div class="item">
								<i class="dropdown icon"></i>
								<span class="text">更多</span>
								<div class="menu">
									<div class="item">告警信息……</div>
									<div class="item">告警信息……</div>
								</div>
							</div>
						</div>
					</div>
					<div class="ui dropdown item">
                        <img class="ui mini circular image" src="../static/images/0.jpg" th:src="@{images/0.jpg}"
                             alt="label-image"/>
						<div class="menu">
							<a class="item" href="#" th:text="${session.userInfo.name}">whstone</a>
							<a class="item" href="mail.html" th:href="@{/logout}">注销</a>
						</div>
					</div>
					<a class="item labeled rightsidebar computer only">
						<i class="ion-wrench large icon"></i>工具
					</a>

				</div>
			</div>
		</div>
		<!--navbar-->
		<!--maincontent-->
		<div class="mainWrap navslide">
			<div class="ui equal width left aligned padded grid stackable">
				<!--Site Content-->
				<div class="sixteen wide column">
					<div class="ui segments">
						<div class="ui segment">
							<h3 class="ui header">
								<span style="display: none" id="host_id" th:text="${hostDetailVO.hostId}">10110</span>
								<span th:text="${hostDetailVO.hostName}">设备名称</span>(
								<span th:text="${hostDetailVO.state}">设备状态</span>)
							</h3>
						</div>
						<div class="ui segment">
							<div class="sixteen wide column">
								<div class="ui grid">
									<div class="four wide column">
										<div class="ui top attached tabular menu">
											<a class="active item" data-tab="first"><h3>配置详情</h3></a>
											<a class="item" data-tab="second"><h3>连接详情</h3></a>
										</div>
										<div class="ui bottom attached active tab segment" style="margin-bottom: 0px" data-tab="first">
											<div class="ui relaxed divided list">
												<div class="item">
													<div class="description">
														<span>设备名： </span>
														<span th:text="${hostDetailVO.hostName}">设备名称</span>
													</div>
												</div>
												<div class="item">
													<div class="description">
														<span>IP：</span>
														<span th:text="${hostDetailVO.ip}">ip</span>
													</div>
												</div>
												<div class="item">
													<div class="description">
														<span>类型：</span>
														<span th:text="${hostDetailVO.type}">type</span>
													</div>
												</div>
												<div class="item">
													<p class="header">描述:</p>
													<div class="description">
														<span th:text="${hostDetailVO.description}">包含一个简单的表格列出设备等信息;</br>部分信息可以伸缩隐藏，例如四种配置接口等数据</span>
													</div>
												</div>
											</div>
										</div>
										<div class="ui bottom attached tab segment" data-tab="second">
											<div class="ui relaxed divided list">
												<div class="item">
													<i class="big green checkmark icon" th:class="(${interfaceVO.agentIp} == null and ${interfaceVO.agentDNS} == null and ${interfaceVO.agentPort} == null) ? 'big red remove icon' :'big green checkmark icon'"></i>
													<div class="content">
														<p class="header">Agent方式</p>
														<div class="description">
															<span>IP：</span>
															<span th:text="${interfaceVO.agentIp}">127.0.0.1</span>
															<span> DNS：</span>
															<span th:text="${interfaceVO.agentDNS}">114.114.114</span>
															<span> 端口号：</span>
															<span th:text="${interfaceVO.agentPort}">10050</span>
														</div>
													</div>
												</div>
												<div class="item">
													<i class="big green checkmark icon" th:class="(${interfaceVO.SNMPIp} == null and ${interfaceVO.SNMPDNS} == null and ${interfaceVO.SNMPPort} == null) ? 'big red remove icon' :'big green checkmark icon'"></i>
													<div class="content">
														<p class="header">SNMP方式</p>
														<div class="description">
															<span>IP：</span>
															<span th:text="${interfaceVO.SNMPIp}">127.0.0.1</span>
															<span>  DNS：</span>
															<span th:text="${interfaceVO.SNMPDNS}">114.114.114.114</span>
															<span>  端口号：</span>
															<span th:text="${interfaceVO.SNMPPort}">10050</span>
														</div>
													</div>
												</div>
												<div class="item">
													<i class="big green checkmark icon" th:class="(${interfaceVO.IPMIIp} == null and ${interfaceVO.IPMIDNS} == null and ${interfaceVO.IPMIPort} == null) ? 'big red remove icon' :'big green checkmark icon'"></i>
													<div class="content">
														<p class="header">IPMI方式</p>
														<div class="description">
															<span>IP：</span>
															<span th:text="${interfaceVO.IPMIIp}">127.0.0.1</span>
															<span>  DNS：</span>
															<span th:text="${interfaceVO.IPMIDNS}">114.114.114.114</span>
															<span>  端口号：</span>
															<span th:text="${interfaceVO.IPMIPort}">10050</span>
														</div>
													</div>
												</div>
												<div class="item">
													<i class="big green checkmark icon" th:class="(${interfaceVO.JMXIp} == null and ${interfaceVO.JMXDNS} == null and ${interfaceVO.JMXPort} == null) ? 'big red remove icon' :'big green checkmark icon'"></i>
													<div class="content">
														<p class="header">JMX方式</p>
														<div class="description">
															<span>IP：</span>
															<span th:text="${interfaceVO.JMXIp}">127.0.0.1</span>
															<span>  DNS：</span>
															<span th:text="${interfaceVO.JMXDNS}">114.114.114.114</span>
															<span>  端口号：</span>
															<span th:text="${interfaceVO.JMXPort}">10050</span>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="twelve wide column">
										<div class="ui segments">
											<div class="ui segment">
												<h3 class="ui header">
													监控点详情
												</h3>
											</div>
											<div class="ui segment">
										<div class="ui six column grid" id="brief_point_id" >
											<div class="column" th:each="pointVO : ${pointVOS}">
												<div class="ui red top attached button" id="0101" th:class="${pointVO.state}=='正常' ? 'ui green top attached button' : (${pointVO.state}=='警告' ? 'ui yellow top attached button' : 'ui red top attached button')  " th:id="p+${pointVO.pointId}" th:text="${pointVO.name}">CPU</div>
											</div>
											<div class="column" th:remove="all" >
												<div class="ui red top attached button" id="0102">CPU</div>
											</div>
											<div class="column" th:remove="all" >
												<div class="ui red top attached button" id="0103">CPU</div>
											</div>
											<div class="column" th:remove="all" >
												<div class="ui yellow top attached button" id="0104">CPU</div>
											</div>
											<div class="column" th:remove="all" >
												<div class="ui yellow top attached button" id="0105">CPU</div>
											</div>
											<div class="column" th:remove="all" >
												<div class="ui yellow top attached button" id="0106">CPU</div>
											</div>
											<div class="column" th:remove="all" >
												<div class="ui yellow top attached button" id="0107">CPU</div>
											</div>
											<div class="column" th:remove="all" >
												<div class="ui green top attached button" id="0108">CPU</div>
											</div>
											<div class="column" th:remove="all">
												<div class="ui green top attached button" id="0109">CPU</div>
											</div>
											<div class="column" th:remove="all">
												<div class="ui green top attached button" id="0110">CPU</div>
											</div>
											<div class="column" th:remove="all">
												<div class="ui green top attached button" id="0111">CPU</div>
											</div>
											<div class="column" th:remove="all">
												<div class="ui red top attached button" id="0112">CPU</div>
											</div>
											<div class="column" th:remove="all">
												<div class="ui red top attached button" id="0113" >CPU</div>
											</div>
											<div class="column" th:remove="all">
												<div class="ui red top attached button" id="0114" >CPU</div>
											</div>
										</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="row" style="padding-top:20px; ">
								<div id="flag_false"></div>
								<div id="flag_true" ></div>
							</div>
						</div>
					</div>
				</div>
				<!--Site Content-->
			</div>
		</div>
		<!--maincontent-->
	</div>
</div>
<th:block th:fragment="bottom_script(scripts)">
	<script src="../static/js/js.cookie.js" th:src="@{js/js.cookie.js}"></script>
	<script src="../static/js/jquery.nicescroll.min.js" th:src="@{js/jquery.nicescroll.min.js}"></script>
	<script data-pace-options='{ "ajax": false }' src="../static/js/pace.js" th:src="@{js/pace.js}"></script>
	<script src="../static/js/main.js" th:src="@{js/main.js}"></script>

    <!--<th:block th:replace="${scripts}"></th:block>-->
</th:block>
<script type="text/javascript">
    //加载监控点悬浮框
    $('#brief_point_id').on('mouseover', '.button',function(e) {
        e.preventDefault();
        var point_id=this.id.substring(1);
        console.log("加载监控点悬浮框的 point_id = " + point_id);
        $.ajax({
            type: "get",
            url: "/brief/point?point_id="+point_id,
            dataType: "json",
            success: function (result) {
                var data = result.data;
                var item_datas=data.item_datas;
                var str_item_datas='';
                for(var i=0; i<item_datas.length; i++){
                    var tmp = ['<tr><td>' +item_datas[i].name+'</td>'
                    +'<td>' +item_datas[i].state+'</td>'
                    /*+'<td>' +item_datas[i].item_id+'</td>'*/
                    +'<td>' +item_datas[i].value+'</td></tr>'].join('');
                    str_item_datas=tmp+str_item_datas;
                }
                var str = ['<div class="ui relaxed divided list">'
                +'<div class="item"><p class="header">名称：' +data.name+'</p></div>'
                /*+'<div class="item"><p class="header">设备ID：' +data.host_id+'</p></div>'
                +'<div class="item"><p class="header">监控点ID：' +data.point_id+'</p></div>'*/
                +'<div class="item"><p class="header">状态：' +data.state+'</p></div>'
                +'<div class="item"><p class="header">监控项：<div class="description">'
                +'<table class="ui very basic compact collapsing celled table no-padding">'
                +str_item_datas+'</table></div></p></div></div>'].join('');
                $("#p"+point_id).attr("data-html",str);
                $("#p"+point_id).popup('show');
            },
            error: function (errorMsg) {
                Lobibox.notify("error", {
                    size: "normal",
                    rounded: false,
                    delayIndicator: true,
                    msg: "连接服务器失败！",
                    icon: "warning icon",
                    title: "监控点详情",
                });
            }
        })
    })
    $('#brief_point_id').on('mouseout', '.button',function(e) {
        console.log("point_id"+this.id);
        $('#brief_point_id .button').popup('hide all');
    })
	//页面加载完后加载监控项的图形
    $(function(){
        var host_id = $("#host_id").text();
        console.log("加载监控项图形的参数：host_id = " + host_id);
        $.ajax({
            type: "get",
            url: "/hostgraphs?host_id="+host_id,
            dataType: "json",
            success: function (result) {
                var data = result.data;
                console.log(data);
                for (var i=0; i<data.length; i++){
                    var id = "i" + data[i].item_id;
                    if (data[i].flag==true)
                    {
                        if($("#flag_true").children().length == 0)
                        {
                            $("#flag_true").append("<h4 class='ui horizontal divider header'><i class='tag icon'></i>自定义监控项</h4> <div class='gridly' id='flag_true_content'>");
                            $("#flag_true_content").append("<div class=' brick small'><div id='"+id+"' class='chart-style'>"+id+"</div></div>");
                        }else {
                            $("#flag_true_content").append("<div class=' brick small'><div id='"+id+"' class='chart-style'>"+id+"</div></div>");
                        }
                    }else {
                        if($("#flag_false").children().length == 0)
                        {
                            $("#flag_false").append("<h4 class='ui horizontal divider header'><i class='tag icon'></i>推荐严重监控项</h4> <div class='gridly ' id='flag_false_content'>");
                            $("#flag_false_content").append("<div class='  brick small'><div id='"+id+"' class='chart-style'>"+id+"</div></div>");
                        }else {
                            $("#flag_false_content").append("<div class='  brick small'><div id='"+id+"' class='chart-style'>"+id+"</div></div>");
                        }
                    }

                    var Color = ['#5FB878', '#DB2828', '#F7B824', '#d2d2d2', '#2F4056'];
                    if (data[i].state == "正常"){ var myColor = Color[0] }
                    if (data[i].state == "严重"){ var myColor = Color[1] }
                    if (data[i].state == "警告"){ var myColor = Color[2] }
                    var myChart = echarts.init(document.getElementById(id));
                    var option = {
                        title: {
                            text: data[i].item_name
                        },
                        tooltip: {},
                        legend: {
                            data:[]
                        },
                        toolbox: {
                            show: true,
                            feature: {
                                magicType: {type: ['line', 'bar']},
                            }
                        },
                        xAxis: {
                            data: data[i].data_time
                        },
                        yAxis: {
                        },
                        series: [{
                            name: data[i].graph_name,
                            type: data[i].graph_type,
                            data: data[i].data,
                            color: [myColor]
                        }]
                    };
                    myChart.setOption(option);
                }
                $('.gridly').gridly({
                    base: 60, // px
                    gutter: 20, // px
                    columns: 12
                });
            },
            error: function (errorMsg) {
                Lobibox.notify("error", {
                    size: "normal",
                    rounded: false,
                    delayIndicator: true,
                    msg: "连接服务器失败！",
                    icon: "warning icon",
                    title: "监控项图形",
                });
            }
        })
	})
</script>

</body>
</html>