<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html>
<head th:replace="layout::common_head(~{::title}, ~{::supplement})">
    <meta charset="UTF-8">
    <title>监控视图</title>
    <script src="../static/js/jquery-3.2.1.min.js" th:src="@{js/jquery-3.2.1.min.js}"></script>
    <script src="../static/js/semantic.js" th:src="@{js/semantic.js}"></script>
    <link rel="stylesheet" href="../static/css/semantic.css" th:href="@{/css/semantic.css}"/>
    <link rel="stylesheet" href="../static/css/icon.css" th:href="@{css/icon.css}"/>
    <link href="../static/css/ionicons.min.css" rel="stylesheet" th:href="@{css/ionicons.min.css}"/>
    <link href="../static/css/main.css" rel="stylesheet" th:href="@{css/main.css}"/>
    <link href="../static/css/pace.css" rel="stylesheet" th:href="@{css/pace.css}"/>
    <link href="../static/css/lobibox.css" rel="stylesheet" th:href="@{css/lobibox.css}"/>
    <th:block th:fragment="supplement">
        <script src="http://rapapi.org/rap.plugin.js?projectId=19544&mode=3"></script>
        <script src="../static/js/echarts.min.js" th:src="@{js/echarts.min.js}"></script>
        <script src="../static/js/jstree.min.js" th:src="@{js/jstree.min.js}"></script>
        <link rel="stylesheet" href="../static/css/jstree-default/style.min.css"
              th:href="@{css/jstree-default/style.min.css}">
        <style type="text/css">
            .ui.table.dataTable thead th {
                border-left: 0px;
            }
        </style>
    </th:block>
</head>
<body>
<!--header start-->
<div id="contextWrap">
    <!--sidebar-->
    <div class="ui sidebar vertical left menu overlay  borderless visible sidemenu inverted  grey" data-color="grey"
         th:replace="layout::left_menu">
        <a class="item logo" href="#">
            <img src="../static/images/logo.png" th:src="@{images/logo.png}" alt="whstone"/><img
                src="../static/images/thumblogo.png" th:src="@{images/thumblogo.png}" alt="whstone"
                class="displaynone"/>
        </a>
        <div class="ui accordion inverted">
            <div class="title item">
                <i class="ion-speedometer titleIcon icon"></i>仪表盘
            </div>
            <div class="content">
                <a class="item" href="#" th:href="@{/dashboard}">仪表盘</a>
            </div>
            <div class="title item" href="#">
                <i class="ion-ios-world titleIcon  icon"></i>业务概览
            </div>
            <div class="content">
            </div>
            <div class="title item">
                <i class="ion-mouse titleIcon icon"></i>设备监控<i class="dropdown icon"></i>
            </div>
            <div class="content">
                <a class="item" href="#" th:href="@{/overview}">设备总览</a>
                <a class="item" href="#">设备详情</a>
            </div>
            <div class="title item" href="#">
                <i class="ion-arrow-graph-up-right titleIcon icon"></i>视图展示
            </div>
            <div class="content">
            </div>
            <div class="title item">
                <i class="ion-paintbrush titleIcon icon"></i>告警展示<i class="dropdown icon"></i>
            </div>
            <div class="content">
                <a class="item" href="#">告警日历</a>
                <a class="item" href="#">告警列表</a>
            </div>
            <div class="title item" href="#">
                <i class="ion-briefcase titleIcon icon"></i>报表统计
            </div>
            <div class="content">
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>仪表盘1</span>
            <i class="ion-speedometer icon"></i>
            <div class="menu">
                <div class="header">
                    仪表盘1
                </div>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>业务概览</span>
            <i class="ion-ios-world icon"></i>
            <div class="menu">
                <div class="header">
                    业务概览
                </div>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>设备监控</span>
            <i class="ion-mouse icon"></i>
            <div class="menu">
                <div class="header">
                    设备监控
                </div>
                <div class="ui divider"></div>
                <a class="item" href="tab.html">设备总览</a>
                <a class="item" href="table.html">设备详情</a>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>视图展示</span>
            <i class="ion-arrow-graph-up-right icon"></i>
            <div class="menu">
                <div class="header">
                    视图展示
                </div>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>告警展示</span>
            <i class="ion-paintbrush icon"></i>
            <div class="menu">
                <div class="header">
                    告警展示
                </div>
                <div class="ui divider"></div>
                <a class="item" href="error.html">告警日历</a>
                <a class="item" href="error.html">告警列表</a>
            </div>
        </div>

        <div class="ui dropdown item displaynone scrolling">
            <span>报表统计</span>
            <a href="error.html">
                <i class="ion-briefcase icon"></i>
            </a>
        </div>

        <div class="ui divider"></div>

    </div>

    <!--sidebar-->

    <div class="pusher">
        <!--navbar-->
        <div class="navslide navwrap" th:replace="layout::top_nav">
            <div class="ui menu icon borderless grid" data-color="inverted white">
                <a class="item labeled openbtn">
                    <i class="ion-navicon-round big icon"></i>
                </a>
                <div class="item ui colhidden">
                    <div class="ui icon input">
                        <input type="text" placeholder="Search...">
                        <i class="search icon"></i>
                    </div>
                </div>
                <div class="right menu colhidden">
                    <div class="ui dropdown item labeled icon">
                        <i class="bell icon"></i> 告警
                        <div class="ui red label mini circular">6</div>
                        <div class="menu">
                            <div class="header">
                                紧急告警
                            </div>
                            <div class="item">
                                告警信息1……
                                <div class="ui teal left pointing label">1</div>
                            </div>
                            <div class="item">
                                告警信息2……
                                <div class="ui label">51</div>
                            </div>
                            <div class="item">
                                告警信息3……
                                <div class="ui label">1</div>
                            </div>
                            <div class="header">
                                严重告警
                            </div>
                            <div class="item">
                                <i class="dropdown icon"></i>
                                <span class="text">更多</span>
                                <div class="menu">
                                    <div class="item">告警信息……</div>
                                    <div class="item">告警信息……</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui dropdown item">
                        <img class="ui mini circular image" src="../static/images/0.jpg" th:src="@{images/0.jpg}"
                             alt="label-image"/>
                        <div class="menu">
                            <a class="item" href="#" th:text="${session.userInfo.name}">whstone</a>
                            <a class="item" href="mail.html" th:href="@{/logout}">注销</a>
                        </div>
                    </div>
                    <a class="item labeled rightsidebar computer only">
                        <i class="ion-wrench large icon"></i>工具
                    </a>

                </div>
            </div>
        </div>
        <!--navbar-->
        <!--maincontent-->
        <div class="mainWrap navslide">
            <div class="ui equal width left aligned padded grid stackable">
                <!--Site Content-->
                <div class="sixteen wide column">
                    <div class="header item">
                        <h2><i class="bar large chart icon"></i>监控视图</h2>
                    </div>
                    <div class="ui grid">
                        <div class="eight wide column"  style="padding-bottom: 0px">
                            <div id="host_select_dropdown" class="ui selection dropdown">
                                <input type="hidden" name="hosts">
                                <i class="dropdown icon"></i>
                                <div class="default text">选择设备</div>
                                <div class="menu">
                                    <div id="select_host" class="item" data-value="host">设备</div>
                                    <div class="disabled item" data-value="platform">业务平台</div>
                                    <div id="select_all" class="item" data-value="all">所有</div>
                                </div>
                            </div>
                        </div>
                        <div class="eight wide column right aligned"  style="padding-bottom: 0px">
                            <button value="currentProblems" class="ui blue button"><i class="add icon"></i>添加</button>
                            <button value="recentProblems" class="ui blue button"><i class="edit icon"></i>编辑</button>
                            <button value="historicalRecord" class="ui blue button"><i class="trash icon"></i>删除</button>
                        </div>
                    </div>
                    <div class="ui grid">
                        <div class="six wide column">
                            <div class="ui segment" style=" min-height : 470px;">
                                <h3>状态统计</h3>
                                <div id="stateStatistics" data-type="statepie">
                                    <div id="host_pie" style="height: 207px">
                                    </div>
                                    <div id="point_pie" style="height: 207px">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ten wide column" style="padding-left: 0">
                            <div class="ui segment" style=" min-height : 470px;">
                                <h3>问题视图</h3>
                                <div id="problemView" data-type="problems">
                                    <table  id="problemsTable" class="ui compact basic table center aligned " width="100%">
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Site Content-->
            </div>
        </div>
        <!--maincontent-->
    </div>
</div>

<th:block th:replace="layout::bottom_script(~{::specialScript})">
    <script src="../static/js/js.cookie.js" th:src="@{js/js.cookie.js}"></script>
    <script src="../static/js/jquery.nicescroll.min.js" th:src="@{js/jquery.nicescroll.min.js}"></script>
    <script data-pace-options='{ "ajax": false }' src="../static/js/pace.js" th:src="@{js/pace.js}"></script>
    <script src="../static/js/main.js" th:src="@{js/main.js}"></script>
    <script src="../static/js/jquery.dataTables.js" th:src="@{js/jquery.dataTables.js}"></script>
    <script src="../static/js/custom-datatable.js" th:src="@{js/custom-datatable.js}"></script>
    <script>
        var Color = ['#5FB878', '#F7B824', '#f11111','#d2d2d2', '#2F4056'];
        //设备pie
        var host_myChart = echarts.init(document.getElementById('host_pie'));
        var host_option={
            title: {
                text: '0',
                subtext: '台设备',
                x: 'center',
                y: 'center',
                itemGap: 1,
                textStyle: {
                    color: '#01AAED',
                    fontFamily: '微软雅黑',
                    fontSize: 24,
                    fontWeight: 'bolder'
                }
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                x: 'right',
                y: 'center',
                data:['正常','警告'],
            },
            grid: {
                left:'5%',
                right:'5%',
            },
            series: [
                {
                    name: '访问来源',
                    type: 'pie',
                    radius: ['40%', '65%'],
                    selectedMode: '',
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                formatter: function (param) {
                                    return param.name + param.value + "台" + ':\n' + Math.round(param.percent) + '%';
                                },
                                textStyle: {
                                    fontWeight: 'bolder'
                                }
                            }
                        },
                    },
                    data:  [
                        {
                            "value": 2,
                            "name": "正常"
                        },
                        {
                            "value": 7,
                            "name": "警告"
                        }
                    ],
                    color: Color
                }
            ]
        };
        host_myChart.setOption(host_option);
        //监控点pie
        var point_myChart = echarts.init(document.getElementById('point_pie'));
        var point_option = {
            title: {
                text: '0',
                subtext: '个监控点',
                x: 'center',
                y: 'center',
                itemGap: 1,
                textStyle: {
                    color: '#01AAED',
                    fontFamily: '微软雅黑',
                    fontSize: 24,
                    fontWeight: 'bolder'
                }
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                x: 'right',
                y: 'center',
                data:['正常','警告'],
            },
            grid: {
                left:'15%',
                right:'15%',
            },
            series: [
                {
                    name: '访问来源',
                    type: 'pie',
                    radius: ['40%', '65%'],
                    selectedMode: '',
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                formatter: function (param) {
                                    return param.name + param.value + "个" + ':\n' + Math.round(param.percent) + '%';
                                },
                                textStyle: {
                                    fontWeight: 'bolder'
                                }
                            }
                        },
                    },
                    data:  [
                        {
                            "value": 5,
                            "name": "正常"
                        },
                        {
                            "value": 5,
                            "name": "警告"
                        }
                    ],
                    color: Color
                }
            ]
        }
        point_myChart.setOption(point_option);

        //页面加载完加载表格数据
        $(function() {
            //初始问题列表
            var problems_Table = $("#problemsTable").DataTable({
                "iDisplayLength": 5,
                order: [0, 'desc'],
                "createdRow": function (row, rowData) {
                    $('td', row).eq(1).addClass('left aligned');
                    $('td', row).eq(2).addClass('left aligned');
                    if (rowData.problem_state === '问题') {
                        if (rowData.priority_state === '警告') {
                            row.classList.add("warning")
                        } else if (rowData.priority_state === '严重') {
                            row.classList.add("negative")
                        } else {
                        }
                    }
                },
                ajax: {
                    url: '/problems/get_current',
                    dataSrc: 'data'
                },
                columns: [
                    {
                        "data": "problem_time",
                        "width": "15%",
                        "title": "发生时间",
                        "orderable": false,
                    },
                    {
                        "data": "host_name",
                        "width": "10%",
                        "title": "设备",
                        "orderable": false,
                    },
                    {
                        "data": "description",
                        "width": "25%",
                        "title": "问题",
                        "orderable": false,

                    },
                    {
                        "data": "priority_state",
                        "width": "5%",
                        "title": "严重性",
                        "orderable": false

                    },
                    {
                        "data": 'problem_state',
                        "width": "15%",
                        "title": "状态",
                        "orderable": false,
                        render: function (data, type, row, meta) {
//                                console.log('render 状态', arguments)
                            if (row.problem_state !== "问题") {
                                return '<div class="ui mini green label" style="margin-bottom: 0px" data-tooltip="恢复时间：' + row.recover_time + '" >' + row.problem_state + '</div>';
                            } else {
                                return '<div class="ui mini red label" style="margin-bottom: 0px">' + row.problem_state + '</div>';
                            }
                        }
                    },
                    {
                        "data": "duration_string",
                        "width": "10%",
                        "title": "持续时间",
                        "orderable": false
                    },
                    {
                        "data": "alert_state",
                        "width": "15%",
                        "title": "告警状态",
                        "orderable": false,
                    },
                    {
                        "data": "acknowledged",
                        "width": "5%",
                        "title": "确认",
                        "orderable": false,
                    }
                ],
            });
        })

    </script>
</th:block>

</body>
</html>